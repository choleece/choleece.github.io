<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="choleece&apos;s blog">
<meta property="og:type" content="website">
<meta property="og:title" content="choleece">
<meta property="og:url" content="https://www.choleece.cn/index.html">
<meta property="og:site_name" content="choleece">
<meta property="og:description" content="choleece&apos;s blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="choleece">
<meta name="twitter:description" content="choleece&apos;s blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://www.choleece.cn/"/>





  <title>choleece</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">choleece</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">blog</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.choleece.cn/2018/07/21/maven-dependency/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="choleece">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="choleece">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/21/maven-dependency/" itemprop="url">å…³äºæ„å»ºmavenå¤šæ¨¡å— dependency dependencyManagment çš„ç”¨æ³•</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-07-21T12:18:14+08:00">
                2018-07-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="dependency-dependencyManagment-åœ¨mavenå¤šæ¨¡å—ä¸­çš„ä½¿ç”¨"><a href="#dependency-dependencyManagment-åœ¨mavenå¤šæ¨¡å—ä¸­çš„ä½¿ç”¨" class="headerlink" title="dependency dependencyManagment åœ¨mavenå¤šæ¨¡å—ä¸­çš„ä½¿ç”¨"></a>dependency dependencyManagment åœ¨mavenå¤šæ¨¡å—ä¸­çš„ä½¿ç”¨</h3><p>dependencyåœ¨å•moduleä¸­ç”¨æ³•ï¼Œåœ¨è¿™å°±ä¸å†èµ˜è¿°ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šèµ„æºä»‹ç»dependencyçš„ã€‚</p>
<p>dependencyManagment åº”ç”¨åœºæ™¯</p>
<p>å½“æˆ‘ä»¬çš„é¡¹ç›®æ¨¡å—ï¼ˆå³æœ‰å¤šä¸ªmoduleï¼‰çš„æ—¶å€™ï¼Œå„æ¨¡å—ä¸­é—´ä¼šæœ‰å¾ˆå¤šçš„åŸºç¡€åŒ…æ˜¯é‡å¤çš„ï¼Œä¸ºäº†é¡¹ç›®çš„æ­£ç¡®è¿è¡Œï¼Œå¿…é¡»è®©æ‰€æœ‰çš„å­é¡¹ç›®ä½¿ç”¨ä¾èµ–é¡¹çš„ç»Ÿä¸€ç‰ˆæœ¬ï¼Œå¿…é¡»ç¡®ä¿åº”ç”¨çš„å„ä¸ªé¡¹ç›®çš„ä¾èµ–é¡¹å’Œç‰ˆæœ¬ä¸€ç›´ï¼Œæ‰èƒ½ä¿è¯æµ‹è¯•å’Œå‘å¸ƒçš„æ˜¯ç›¸åŒçš„ç»“æœã€‚</p>
<p>åœ¨é¡¶å±‚çš„pomæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¼šæŠ½è±¡å‡ºä¸€äº›å„å­æ¨¡å—ä¼šå…¬ç”¨çš„jaråŒ…ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬ç”¨dependencyManagementæ¥ç®¡ç†ï¼Œè®©å­é¡¹ç›®ä¸­å¼•ç”¨ä¸€ä¸ªä¾èµ–è€Œä¸ç”¨æ˜¾ç¤ºçš„åˆ—å‡ºç‰ˆæœ¬å·ã€‚Mavenä¼šæ²¿ç€çˆ¶å­å±‚æ¬¡å‘ä¸Šèµ°ï¼ŒçŸ¥é“æ‰¾åˆ°ä¸€ä¸ªæ‹¥æœ‰dependencyManagementå…ƒç´ çš„é¡¹ç›®ï¼Œç„¶åå®ƒå°±ä¼šä½¿ç”¨åœ¨è¿™ä¸ªdependencyManagementå…ƒç´ ä¸­åˆ¶å®šçš„ç‰ˆæœ¬å·ã€‚</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°†ä¸¾ä¾‹å­æ¥è¯´æ˜è¿™ä¸ªé—®é¢˜ï¼š<br>é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">zheng-boot</span><br><span class="line">         |</span><br><span class="line">          zheng-boot-common</span><br><span class="line">         |</span><br><span class="line">          zheng-boot-cms</span><br><span class="line">                        |</span><br><span class="line">                         zheng-boot-cms-admin</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªé¡¹ç›®å¤§æ¦‚æœ‰ä¸‰å±‚ï¼Œzheng-bootä½œä¸ºé¡¶çº§projectï¼Œzheng-bootä¸‹åˆæœ‰zheng-boot-common å’Œ zheng-boot-cmsä¸¤ä¸ªæ¨¡å—ï¼Œç„¶åzheng-boot-cmsä¸‹è¾¹åˆæœ‰zheng-boot-cms-adminä¸€ä¸ªå­æ¨¡å—ã€‚</p>
<p>å…ˆå°†å„é¡¹ç›®çš„pom.xmlçš„ä»£ç è´´å‡ºæ¥ï¼Œç»™å¤§å®¶çœ‹çœ‹ï¼Œç„¶åç…§ç€pom.xmlç»™å¤§å®¶è®²è§£</p>
<p>zheng-bootçš„pom.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&lt;-- zheng-boot pom.xml --&gt;</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">       xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">  &lt;groupId&gt;cn.choleece&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;zheng-boot&lt;/artifactId&gt;</span><br><span class="line">  &lt;packaging&gt;pom&lt;/packaging&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line"></span><br><span class="line">  &lt;properties&gt;</span><br><span class="line">      &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">      &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;</span><br><span class="line">      &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;</span><br><span class="line">      &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;</span><br><span class="line">      &lt;maven.compiler.compilerVersion&gt;1.8&lt;/maven.compiler.compilerVersion&gt;</span><br><span class="line">      &lt;java.version&gt;1.8&lt;/java.version&gt;</span><br><span class="line">      &lt;spring.version&gt;5.0.7.RELEASE&lt;/spring.version&gt;</span><br><span class="line">  &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">  &lt;parent&gt;</span><br><span class="line">      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;2.0.3.RELEASE&lt;/version&gt;</span><br><span class="line">      &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">  &lt;/parent&gt;</span><br><span class="line"></span><br><span class="line">  &lt;modules&gt;</span><br><span class="line">      &lt;module&gt;zheng-boot-common&lt;/module&gt;</span><br><span class="line">      &lt;module&gt;zheng-boot-cms&lt;/module&gt;</span><br><span class="line">  &lt;/modules&gt;</span><br><span class="line"></span><br><span class="line">  &lt;dependencyManagement&gt;</span><br><span class="line">      &lt;dependencies&gt;</span><br><span class="line"></span><br><span class="line">          &lt;dependency&gt;</span><br><span class="line">              &lt;groupId&gt;cn.choleece.zhengboot&lt;/groupId&gt;</span><br><span class="line">              &lt;artifactId&gt;zheng-boot-common&lt;/artifactId&gt;</span><br><span class="line">              &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">          &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">          &lt;dependency&gt;</span><br><span class="line">              &lt;groupId&gt;cn.choleece.zhengboot&lt;/groupId&gt;</span><br><span class="line">              &lt;artifactId&gt;zheng-boot-cms&lt;/artifactId&gt;</span><br><span class="line">              &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">          &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">          &lt;dependency&gt;</span><br><span class="line">              &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">              &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">              &lt;version&gt;2.0.3.RELEASE&lt;/version&gt;</span><br><span class="line">          &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">          &lt;dependency&gt;</span><br><span class="line">              &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">              &lt;artifactId&gt;druid&lt;/artifactId&gt;</span><br><span class="line">              &lt;version&gt;1.1.10&lt;/version&gt;</span><br><span class="line">          &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">      &lt;/dependencies&gt;</span><br><span class="line">  &lt;/dependencyManagement&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>
<p>zheng-boot-commonçš„pom.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">  &lt;-- zheng-boot-common pom.xml --&gt;</span><br><span class="line"></span><br><span class="line">  &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;zheng-boot&lt;/artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;cn.choleece&lt;/groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;cn.choleece.zhengboot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;zheng-boot-common&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;packaging&gt;pom&lt;/packaging&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;</span><br><span class="line">        &lt;java.version&gt;1.8&lt;/java.version&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!--generate ids using snowflake--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.relops&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;snowflake&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.1&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>
<p>zheng-boot-cmsçš„pom.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">  &lt;-- zheng-boot-cms pom.xml --&gt;</span><br><span class="line"></span><br><span class="line">  &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;zheng-boot&lt;/artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;cn.choleece&lt;/groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">        &lt;relativePath&gt;../pom.xml&lt;/relativePath&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;cn.choleece.zhengboot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;zheng-boot-cms&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;packaging&gt;pom&lt;/packaging&gt;</span><br><span class="line"></span><br><span class="line">    &lt;name&gt;zheng-boot-cms&lt;/name&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;</span><br><span class="line">        &lt;maven.compiler.compilerVersion&gt;1.8&lt;/maven.compiler.compilerVersion&gt;</span><br><span class="line">        &lt;java.version&gt;1.8&lt;/java.version&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;modules&gt;</span><br><span class="line">        &lt;module&gt;zheng-boot-cms-admin&lt;/module&gt;</span><br><span class="line">    &lt;/modules&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;cn.choleece.zhengboot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;zheng-boot-common&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencyManagement&gt;</span><br><span class="line">        &lt;dependencies&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;1.2.47&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line">        &lt;/dependencies&gt;</span><br><span class="line">    &lt;/dependencyManagement&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>
<p>zheng-boot-cms-admin çš„pom.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">  &lt;-- zheng-boot-cms-admin pom.xml --&gt;</span><br><span class="line"></span><br><span class="line">  &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">	xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">	&lt;parent&gt;</span><br><span class="line">		&lt;artifactId&gt;zheng-boot-cms&lt;/artifactId&gt;</span><br><span class="line">		&lt;groupId&gt;cn.choleece.zhengboot&lt;/groupId&gt;</span><br><span class="line">		&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">		&lt;relativePath&gt;../pom.xml&lt;/relativePath&gt;</span><br><span class="line">	&lt;/parent&gt;</span><br><span class="line">	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">	&lt;groupId&gt;cn.choleece.zhengboot&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;zheng-boot-cms-admin&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span><br><span class="line">	&lt;packaging&gt;jar&lt;/packaging&gt;</span><br><span class="line"></span><br><span class="line">	&lt;name&gt;zheng-boot-cms-admin&lt;/name&gt;</span><br><span class="line">	&lt;description&gt;zheng-boot-cms-admin&lt;/description&gt;</span><br><span class="line"></span><br><span class="line">	&lt;properties&gt;</span><br><span class="line">		&lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">		&lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;</span><br><span class="line">		&lt;java.version&gt;1.8&lt;/java.version&gt;</span><br><span class="line">	&lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">	&lt;dependencies&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;druid&lt;/artifactId&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">	&lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">	&lt;build&gt;</span><br><span class="line">		&lt;plugins&gt;</span><br><span class="line">			&lt;plugin&gt;</span><br><span class="line">				&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">				&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">			&lt;/plugin&gt;</span><br><span class="line">		&lt;/plugins&gt;</span><br><span class="line">	&lt;/build&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œåˆ†æä¸€ä¸‹å„moduleçš„jaréƒ½æ˜¯æ¥è‡ªå“ªé‡Œï¼Œå¼„æ¸…äº†æ¥æºï¼ŒåŸºæœ¬ä¹Ÿå°±ç†è§£äº†ã€‚</p>
<p>å…ˆçœ‹æœ€åº•å±‚çš„ï¼Œzheng-boot-cms-admin</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨zheng-boot-cms-adminè¿™ä¸ªmoduleé‡Œï¼Œæœ‰druid å’Œ fastjsonï¼Œæˆ‘ä»¬é¦–å…ˆçœ‹druidï¼Œåœ¨æœ¬pom.xmlé‡Œï¼Œdruidæ²¡æœ‰ç‰ˆæœ¬å·ï¼Œåˆ™æ˜¯å¼•ç”¨çš„çˆ¶pomï¼Œadminçš„çˆ¶pomé‡Œï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°dependencyManagementé‡Œæœ‰å®šä¹‰druidï¼Œæ‰€ä»¥adminé‡Œç›´æ¥å¼•ç”¨çš„å°±æ˜¯cms pom.xmlé‡Œçš„ç‰ˆæœ¬å·ï¼Œå†çœ‹fastjsonï¼ŒåŒæ ·çš„æ²¡æœ‰ç‰ˆæœ¬å·ï¼Œå¾€ä¸Šè¿½æº¯åˆ°cmsçš„pomï¼Œå‘ç°å¹¶æ²¡æœ‰fastjsonçš„å®šä¹‰ï¼Œæ¥ç€æˆ‘ä»¬çœ‹adminçš„çˆ¶pom zheng-bootçš„dependencyManagementé‡Œæœ‰å®šä¹‰fastjsonï¼ŒåŒæ ·æ˜¯å¯ä»¥å¼•ç”¨åˆ°çš„ï¼Œä¹Ÿå°±æ˜¯å®ƒä¼šä¸€ç›´å¾€ä¸Šè¿½æº¯ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„åˆ°æ˜¯ï¼Œåœ¨cmsçš„dependencyManagementé‡Œä¸èƒ½å¼•ç”¨zheng-boot dependencyManagementçš„åŒ…ï¼Œå¦åˆ™åœ¨å­moduleå¼•ç”¨çš„æ—¶å€™ä¼šå‘ç°æ‰¾ä¸åˆ°ç‰ˆæœ¬å·ã€‚</p>
<p>æˆ‘ä»¬å†çœ‹zheng-boot-commoné‡Œçš„snowflakeï¼Œæˆ‘ä»¬åœ¨adminé¡¹ç›®é‡Œæ˜¯å¯ä»¥ç›´æ¥ç”¨çš„ï¼Œè¯æ˜snowflagçš„jaråŒ…å·²ç»åŠ è½½åˆ°äº†amdinçš„classpathä¸‹ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹è¿™æ˜¯ä»€ä¹ˆæ ·çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚å½“æˆ‘ä»¬åœ¨adminé¡¹ç›®é‡Œç”¨snowflakeçš„æ—¶å€™ï¼Œadminä¼šå»æ‰¾è‡ªå·±pomä¸‹çš„jaråŒ…ï¼Œå‘ç°æ²¡æœ‰pomé‡Œæ²¡æœ‰å£°æ˜ï¼Œç„¶åç»§ç»­å¯»æ‰¾adminçš„çˆ¶pom cmsï¼Œå‘ç°cms çš„pom é‡Œä¹Ÿæ²¡æœ‰æ˜ç¡®å£°æ˜snowflakeï¼Œä½†æ˜¯å¼•ç”¨é‡Œcommonï¼Œç„¶åcommoné‡Œå£°æ˜äº†snowflakeï¼Œæ‰€ä»¥adminå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p>
<p>çœ‹åˆ°ä¸Šè¾¹ï¼Œæˆ‘æƒ³å¤§å®¶å·²ç»æ¸…æ¥šäº†å„é¡¹ç›®æ¨¡å—ä¸‹çš„jaråŒ…çš„æ¥æºï¼Œä¹Ÿä¼šå‘ç°dependency å’Œ dependencyManagementçš„åŒºåˆ«ï¼Œå®ƒä¸¤ä¸€ä¸ªæ˜æ˜¾çš„åŒºåˆ«å°±æ˜¯ï¼Œå¦‚æœåœ¨çˆ¶pomçš„dependencyå¼•å…¥çš„jaråŒ…ï¼Œé‚£ä¹ˆä¼šç›´æ¥â€œç»§æ‰¿â€åˆ°å­pomé‡Œï¼Œåœ¨å­pomé‡Œä¸ç”¨æ˜¾ç¤ºçš„å¼•ç”¨å°±å¯ä»¥ä½¿ç”¨ï¼›å¦‚æœæ˜¯åœ¨çˆ¶pomçš„dependencyManagementå¼•å…¥çš„jaråŒ…ï¼Œåˆ™éœ€è¦åœ¨å­pomé‡Œéœ€è¦æ˜¾ç¤ºçš„å¼•ç”¨ï¼Œåªä¸è¿‡ä¸éœ€è¦å†™versionã€‚å¦å¤–ï¼ŒdependencyManagementä¸æ”¯æŒâ€œç»§æ‰¿â€ï¼Œå³åœ¨zheng-boot çš„dependencyManagementé‡Œå®šä¹‰çš„jaråŒ…ï¼Œä¸èƒ½åœ¨zheng-boot-cmsçš„dependencyManagementé‡Œä½¿ç”¨ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.choleece.cn/2018/06/24/thread/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="choleece">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="choleece">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/24/thread/" itemprop="url">å¤šçº¿ç¨‹çŸ¥è¯†é¢è¯•æ±‡æ€»</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-06-24T22:14:51+08:00">
                2018-06-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ"></a>1. ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ</h3><p>çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿèƒ½å¤Ÿè¿›è¡Œè¿ç®—è°ƒåº¦çš„æœ€å°å•ä½ï¼Œå®ƒåŒ…å«åœ¨è¿›ç¨‹ä¸­ï¼Œæ˜¯è¿›ç¨‹ä¸­çš„å®é™…è¿ä½œå•ä½ï¼Œå¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹å¯¹è¿ç®—è¿›è¡Œæé€Ÿã€‚</p>
<h3 id="2-ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨å’Œçº¿ç¨‹ä¸å®‰å…¨ï¼Ÿ"><a href="#2-ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨å’Œçº¿ç¨‹ä¸å®‰å…¨ï¼Ÿ" class="headerlink" title="2. ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨å’Œçº¿ç¨‹ä¸å®‰å…¨ï¼Ÿ"></a>2. ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨å’Œçº¿ç¨‹ä¸å®‰å…¨ï¼Ÿ</h3><p>é€šä¿—çš„è¯´ï¼šåŠ é”å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸åŠ é”å°±æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚</p>
<h4 id="çº¿ç¨‹å®‰å…¨"><a href="#çº¿ç¨‹å®‰å…¨" class="headerlink" title="çº¿ç¨‹å®‰å…¨"></a>çº¿ç¨‹å®‰å…¨</h4><p>çº¿ç¨‹å®‰å…¨ï¼šå°±æ˜¯å¤šçº¿ç¨‹è®¿é—®æ—¶ï¼Œé‡‡ç”¨åŠ é”æœºåˆ¶ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®è¯¥ç±»çš„æŸä¸ªæ•°æ®æ—¶ï¼Œè¿›è¡Œä¿æŠ¤ï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½è¿›è¡Œè®¿é—®ï¼ŒçŸ¥é“è¯¥çº¿ç¨‹è¯»å–å®Œï¼Œå…¶ä»–çº¿ç¨‹æ‰å¯ä½¿ç”¨ã€‚ä¸ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´æˆ–è€…æ•°æ®æ±¡æŸ“ã€‚</p>
<p>ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„è®¡æ•°å™¨ç±»çš„åŒä¸€ä¸ªå®ä¾‹å¯¹è±¡åœ¨è¢«å¯¹å¤šä¸ªçº¿ç¨‹ä½¿ç”¨çš„æƒ…å†µä¸‹ä¹Ÿä¸ä¼šå‡ºç°è®¡ç®—å¤±è¯¯ã€‚å¾ˆæ˜¾ç„¶ä½ å¯ä»¥å°†é›†åˆç±»åˆ†æˆä¸¤ç»„ï¼Œçº¿ç¨‹å®‰å…¨å’Œéçº¿ç¨‹å®‰å…¨ã€‚<br>Vectoræ˜¯ç”¨åŒæ­¥æ–¹æ³•æ¥å®ç°çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œå’Œå®ƒç›¸ä¼¼çš„ArrayListä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<h4 id="çº¿ç¨‹ä¸å®‰å…¨"><a href="#çº¿ç¨‹ä¸å®‰å…¨" class="headerlink" title="çº¿ç¨‹ä¸å®‰å…¨"></a>çº¿ç¨‹ä¸å®‰å…¨</h4><p>çº¿ç¨‹ä¸å®‰å…¨ï¼šå°±æ˜¯ä¸æä¾›æ•°æ®è®¿é—®ä¿æŠ¤ï¼Œæœ‰å¯èƒ½å‡ºç°å¤šä¸ªçº¿ç¨‹å…ˆåæ›´æ”¹æ•°æ®é€ æˆæ‰€å¾—åˆ°çš„æ•°æ®æ˜¯è„æ•°æ®ã€‚</p>
<h3 id="3-ä»€ä¹ˆæ˜¯è‡ªæ—‹é”ï¼Ÿ"><a href="#3-ä»€ä¹ˆæ˜¯è‡ªæ—‹é”ï¼Ÿ" class="headerlink" title="3. ä»€ä¹ˆæ˜¯è‡ªæ—‹é”ï¼Ÿ"></a>3. ä»€ä¹ˆæ˜¯è‡ªæ—‹é”ï¼Ÿ</h3><p>è‡ªæ—‹é”æ˜¯SMPæ¶æ„ä¸­çš„ä¸€ç§low-levelçš„åŒæ­¥æœºåˆ¶ã€‚</p>
<p>å½“çº¿ç¨‹Aæƒ³è¦è·å–ä¸€æŠŠè‡ªæ—‹é”è€Œè¯¥æ‰€åˆè¢«å…¶ä»–çº¿ç¨‹æŒæœ‰æ—¶ï¼Œçº¿ç¨‹Aä¼šåœ¨ä¸€ä¸ªå¾ªç¯ä¸­è‡ªæ—‹ä»¥æ£€æµ‹é”æ˜¯ä¸æ˜¯å·²ç»å¯ä»¥å¯ç”¨äº†ã€‚</p>
<h4 id="è‡ªæ—‹é”éœ€è¦æ³¨æ„ï¼š"><a href="#è‡ªæ—‹é”éœ€è¦æ³¨æ„ï¼š" class="headerlink" title="è‡ªæ—‹é”éœ€è¦æ³¨æ„ï¼š"></a>è‡ªæ—‹é”éœ€è¦æ³¨æ„ï¼š</h4><ul>
<li>ç”±äºè‡ªæ—‹ä¸é‡Šæ”¾CPUï¼Œå› è€ŒæŒæœ‰è‡ªæ—‹é”çš„çº¿ç¨‹åº”è¯¥å°½å¿«é‡Šæ”¾è‡ªæ—‹é”ï¼Œå¦åˆ™ç­‰å¾…è¯¥è‡ªæ—‹é”çš„çº¿ç¨‹ä¼šä¸€ç›´åœ¨é‚£é‡Œè‡ªæ—‹ï¼Œè¿™å°±ä¼šæµªè´¹CPUæ—¶é—´ã€‚</li>
<li>æŒæœ‰è‡ªæ—‹é”çš„çº¿ç¨‹åœ¨sleepä¹‹å‰åº”è¯¥é‡Šæ”¾è‡ªæ—‹é”ä»¥ä¾¿å…¶ä»–çº¿ç¨‹å¯ä»¥è·å¾—è‡ªæ—‹é”é”ã€‚</li>
</ul>
<p>è‡ªæ—‹é”çš„å®ç°ï¼š<br>ç›®å‰çš„JVMå®ç°è‡ªæ—‹é”ä¼šæ¶ˆè€—CPUï¼Œå¦‚æœé•¿æ—¶é—´ä¸è°ƒç”¨doNotifyæ–¹æ³•ï¼ŒdoWaitæ–¹æ³•ä¼šä¸€ç›´è‡ªæ—‹ï¼ŒCPUä¼šæ¶ˆè€—å¤ªå¤§ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public class MyWaitNotify &#123;</span><br><span class="line">    MonitorObject myMonitorObject = new MonitorObject();</span><br><span class="line">    boolean wasSignalled = false;</span><br><span class="line"></span><br><span class="line">    public void doWait() &#123;</span><br><span class="line">        synchronized(myMonitorObject) &#123;</span><br><span class="line">            while(!wasSignalled) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    myMoniorObject.wait();</span><br><span class="line">                &#125; catch(InterruptedException e) &#123;...&#125;;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // clear singal and continue running..</span><br><span class="line">             wasSinnalled = false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void doNotify() &#123;</span><br><span class="line">        synchronized(myMonitorObject) &#123;</span><br><span class="line">            wasSignalled = true;</span><br><span class="line">            myMonitorObject.notify();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-ä»€ä¹ˆæ˜¯Javaå†…å­˜æ¨¡å‹ï¼Ÿ"><a href="#4-ä»€ä¹ˆæ˜¯Javaå†…å­˜æ¨¡å‹ï¼Ÿ" class="headerlink" title="4. ä»€ä¹ˆæ˜¯Javaå†…å­˜æ¨¡å‹ï¼Ÿ"></a>4. ä»€ä¹ˆæ˜¯Javaå†…å­˜æ¨¡å‹ï¼Ÿ</h3><p>Javaå†…å­˜æ¨¡å‹æè¿°äº†åœ¨å¤šçº¿ç¨‹ä¸­å“ªäº›è¡Œä¸ºæ˜¯åˆæ³•çš„ï¼Œä»¥åŠçº¿ç¨‹å¦‚ä½•é€šè¿‡å†…å­˜è¿›è¡Œäº¤äº’ã€‚å®ƒæè¿°äº†â€ç¨‹åºä¸­çš„å˜é‡â€å’Œâ€ä»å†…å­˜æˆ–è€…å¯„å­˜å™¨è·å–æˆ–å­˜å‚¨å®ƒä»¬çš„åº•å±‚ç»†èŠ‚â€ä¹‹é—´çš„å…³ç³»ã€‚Javaå†…å­˜æ¨¡å‹é€šè¿‡ä½¿ç”¨å„ç§å„æ ·çš„ç¡¬ä»¶å’Œç¼–è¯‘å™¨çš„ä¼˜åŒ–æ¥åšæ­£ç¡®å®ç°ä»¥ä¸Šäº‹æƒ…ã€‚</p>
<p>JavaåŒ…å«äº†å‡ ä¸ªè¯­éŸ³çº§åˆ«çš„å…³é”®å­—ï¼ŒåŒ…æ‹¬ï¼švolatile, finalä»¥åŠsynchronizedï¼Œç›®çš„æ˜¯ä¸ºäº†å¸®åŠ©ç¨‹åºå‘˜å‘ç¼–è¯‘å™¨æè¿°ä¸€ä¸ªç¨‹åºçš„å¹¶å‘éœ€æ±‚ã€‚Javaå†…å­˜æ¨¡å‹å®šä¹‰äº†volatileå’Œsynchronizedè¡Œä¸ºï¼Œæ›´é‡è¦çš„æ˜¯ä¿è¯äº†åŒæ­¥çš„Javaç¨‹åºåœ¨æ‰€æœ‰çš„å¤„ç†å™¨æ¶æ„ä¸‹é¢éƒ½èƒ½æ­£ç¡®çš„è¿è¡Œã€‚</p>
<p>â€œä¸€ä¸ªçº¿ç¨‹çš„å†™æ“ä½œå¯¹å…¶ä»–çº¿ç¨‹å¯è§â€è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸ºç¼–è¯‘å™¨å¯¹ä»£ç è¿›è¡Œé‡æ’åºå¯¼è‡´å¯¹ã€‚ä¾‹å¦‚ï¼Œåªè¦ä»£ç ç§»åŠ¨ä¸ä¼šæ”¹å˜ç¨‹åºçš„è¯­ä¹‰ï¼Œå½“ç¼–è¯‘å™¨è®¤ä¸ºç¨‹åºä¸­ç§»åŠ¨ä¸€ä¸ªå†™æ“ä½œåˆ°åè¾¹ä¼šæ›´æœ‰æ•ˆçš„æ—¶å€™ï¼Œç¼–è¯‘å™¨å°±ä¼šå¯¹ä»£ç è¿›è¡Œç§»åŠ¨ã€‚å¦‚æœç¼–è¯‘å™¨æ¨è¿Ÿæ‰§è¡Œä¸€ä¸ªæ“ä½œï¼Œå…¶ä»–çº¿ç¨‹å¯èƒ½åœ¨è¿™ä¸ªæ“ä½œæ‰§è¡Œå®Œä¹‹å‰éƒ½ä¸ä¼šçœ‹åˆ°è¿™ä¸ªæ“ä½œç»“æœï¼Œè¿™åæ˜ äº†æ¢æˆçš„å½±å“ã€‚</p>
<p>æ­¤å¤–ï¼Œå†™å…¥å†…å­˜çš„æ“ä½œèƒ½å¤Ÿè¢«ç§»åŠ¨åˆ°ç¨‹åºé‡Œæ›´å‰çš„æ—¶å€™ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¶ä»–çš„çº¿ç¨‹åœ¨ç¨‹åºä¸­å¯èƒ½çœ‹åˆ°ä¸€ä¸ªæ¯”å®ƒå®é™…å‘ç”Ÿæ›´æ—©çš„å†™æ“ä½œã€‚æ‰€æœ‰çš„è¿™äº›çµæ´»æ€§çš„è®¾è®¡æ˜¯ä¸ºäº†é€šè¿‡ç»™ç¼–è¯‘å™¨ï¼Œè¿è¡Œæ—¶æˆ–ç¡¬ä»¶çµæ´»æ€§ä½¿å…¶èƒ½åœ¨æœ€ä½³é¡ºåºçš„æƒ…å†µä¸‹æ‰§è¡Œæ“ä½œã€‚åœ¨å†…å­˜æ¨¡å‹çš„é™å®šä¹‹å†…ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè·å–æ›´é«˜çš„æ€§èƒ½ã€‚<br>çœ‹ä¸‹é¢ä»£ç å±•ç¤ºçš„ä¸€ä¸ªç®€å•ä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Class Recording &#123;</span><br><span class="line">    int x = 0, y = 0;</span><br><span class="line"></span><br><span class="line">    public void writer() &#123;</span><br><span class="line">        x = 1;</span><br><span class="line">        y = 2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void reader() &#123;</span><br><span class="line">        int r1 = y;</span><br><span class="line">        int r2 = x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è®©æˆ‘ä»¬çœ‹åœ¨ä¸¤ä¸ªå¹¶å‘çº¿ç¨‹ä¸­æ‰§è¡Œè¿™æ®µä»£ç ï¼Œè¯»å–Yå˜é‡ä¼šå¾—åˆ°2ä¸ªè¿™ä¸ªğŸˆ¯ï¸å€¼ã€‚å› ä¸ºè¿™ä¸ªå†™å…¥æ¯”å†™åˆ°Xå˜é‡æ›´æ™šä¸€äº›ï¼Œç¨‹åºå‘˜å¯èƒ½è®¤ä¸ºè¯»å–Xå˜é‡å°†è‚¯å®šå¾—åˆ°1ï¼Œä½†æ˜¯ï¼Œå†™å…¥æ“ä½œå¯èƒ½è¢«é‡æ’åºè¿‡ï¼Œå¦‚æœé‡æ’åºå‘ç”Ÿäº†ï¼Œé‚£ä¹ˆå°±èƒ½å‘ç”Ÿå¯¹Yå˜é‡çš„å†™å…¥æ“ä½œï¼Œè¯»å–ä¸¤ä¸ªå˜é‡çš„æ“ä½œç´§éšå…¶åï¼Œè€Œä¸”å†™å…¥åˆ°Xè¿™ä¸ªæ“ä½œèƒ½å‘ç”Ÿã€‚ç¨‹åºçš„ç»“æœå¯èƒ½æ˜¯r1å˜é‡çš„å€¼æ˜¯2ï¼Œä½†æ˜¯r2å˜é‡çš„å€¼ä¸º0</p>
<p>ä½†æ˜¯é¢è¯•å®˜ï¼Œæœ‰æ—¶å€™ä¸è¿™ä¹ˆè®¤ä¸ºï¼Œè®¤ä¸ºå°±æ˜¯JVMå†…å­˜ç»“æ„<br>JVMå†…å­˜ç»“æ„ä¸»è¦æœ‰ä¸‰å—ï¼šå¯¹å†…å­˜ã€æ–¹æ³•åŒºå’Œæ ˆã€‚</p>
<p>å †å†…å­˜æ˜¯JVMä¸­æœ€å¤§çš„ä¸€å—ç”±å¹´è½»ä»£å’Œè€å¹´ä»£ç»„æˆï¼Œè€Œå¹´è½»ä»£å†…å­˜åˆè¢«åˆ†æˆä¸‰éƒ¨åˆ†ï¼ŒEdenç©ºé—´ï¼ŒFrom Survivorç©ºé—´ã€To Survivorç©ºé—´ï¼Œé»˜è®¤æƒ…å†µä¸‹å¹´è½»ä»£æŒ‰ç…§8:1:1çš„æ¯”ä¾‹æ¥åˆ†é…ï¼›æ–¹æ³•åŒºå­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰æ•°æ®ï¼Œæ˜¯çº¿ç¨‹å…±äº«çš„åŒºåŸŸï¼Œä¸ºä¸Javaå †åŒºåˆ†ï¼Œæ–¹æ³•å»è¿˜æœ‰ä¸€ä¸ªåˆ«åNon-Heap(éå †)ï¼›æ ˆåˆåˆ†ä¸ºJavaè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆä¸»è¦ç”¨äºæ–¹æ³•çš„æ‰§è¡Œã€‚</p>
<h4 id="Javaçš„JVMçš„å†…å­˜å¯åˆ†ä¸º3ä¸ªåŒºï¼šå †ï¼ˆheapï¼‰ã€æ ˆ-stack-å’Œæ–¹æ³•åŒºï¼ˆmethodï¼‰"><a href="#Javaçš„JVMçš„å†…å­˜å¯åˆ†ä¸º3ä¸ªåŒºï¼šå †ï¼ˆheapï¼‰ã€æ ˆ-stack-å’Œæ–¹æ³•åŒºï¼ˆmethodï¼‰" class="headerlink" title="Javaçš„JVMçš„å†…å­˜å¯åˆ†ä¸º3ä¸ªåŒºï¼šå †ï¼ˆheapï¼‰ã€æ ˆ(stack)å’Œæ–¹æ³•åŒºï¼ˆmethodï¼‰"></a>Javaçš„JVMçš„å†…å­˜å¯åˆ†ä¸º3ä¸ªåŒºï¼šå †ï¼ˆheapï¼‰ã€æ ˆ(stack)å’Œæ–¹æ³•åŒºï¼ˆmethodï¼‰</h4><p>Javaå †ï¼ˆJava Heapï¼‰</p>
<ul>
<li>å¯é€šè¿‡å‚æ•° -Xmså’ŒXmxè®¾ç½®</li>
</ul>
<ol>
<li>Javaå †æ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œæ˜¯Javaè™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—Javaå †åœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚</li>
<li>Javaå †å”¯ä¸€å †ç›®çš„æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½åœ¨è¿™é‡Œã€‚</li>
<li>Javaå †ä¸ºäº†ä¾¿äºæ›´å¥½å †å›æ”¶å’Œåˆ†é…å†…å­˜ï¼Œå¯ä»¥ç»†åˆ†ä¸ºï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼›åœ¨ç»†è‡´ä¸€ç‚¹æœ‰Edenç©ºé—´ã€From Survivorç©ºé—´ã€To SurvivoråŒºã€‚<br> a. æ–°ç”Ÿä»£ï¼šåŒ…æ‹¬EdenåŒºã€From SurvivoråŒºã€To SurvivoråŒºã€ç³»ç»Ÿé»˜è®¤å¤§å°Eden : Survivor = 8 : 1;<br> b. è€å¹´ä»£ï¼šåœ¨å¹´è½»ä»£ç»å†äº†Næ¬¡åƒåœ¾å›æ”¶åä»ç„¶å­˜æ´»çš„å¯¹è±¡ï¼Œå°±ä¼šè¢«æ”¾åˆ°è€å¹´ä»£ä¸­ï¼Œå› æ­¤ï¼Œå¯ä»¥è®¤ä¸ºè€å¹´ä»£ä¸­å­˜æ”¾çš„éƒ½æ˜¯ä¸€äº›ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€‚</li>
<li>Survivorç©ºé—´ç­‰Javaå †å¯ä»¥å¤„åœ¨ç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜å…±å»ºä¸­ï¼Œåªè¦é€»è¾‘ä¸Šæ˜¯è¿ç»­çš„å³å¯ã€‚</li>
</ol>
<h5 id="æ®Javaè™šæ‹Ÿæœºè§„èŒƒè§„å®šï¼Œå½“æ–¹æ³•åŒºå–æ³•æ»¡è¶³å†…å­˜åˆ†é…éœ€æ±‚æ—¶ï¼Œå°†æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚"><a href="#æ®Javaè™šæ‹Ÿæœºè§„èŒƒè§„å®šï¼Œå½“æ–¹æ³•åŒºå–æ³•æ»¡è¶³å†…å­˜åˆ†é…éœ€æ±‚æ—¶ï¼Œå°†æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚" class="headerlink" title="æ®Javaè™šæ‹Ÿæœºè§„èŒƒè§„å®šï¼Œå½“æ–¹æ³•åŒºå–æ³•æ»¡è¶³å†…å­˜åˆ†é…éœ€æ±‚æ—¶ï¼Œå°†æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚"></a>æ®Javaè™šæ‹Ÿæœºè§„èŒƒè§„å®šï¼Œå½“æ–¹æ³•åŒºå–æ³•æ»¡è¶³å†…å­˜åˆ†é…éœ€æ±‚æ—¶ï¼Œå°†æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</h5><p>æœ¬åœ°æ–¹æ³•æ ˆ</p>
<ul>
<li>å¯é€šè¿‡å‚æ•° æ ˆå®¹é‡å¯ç”±-Xssè®¾ç½®</li>
</ul>
<ol>
<li>è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡ŒJavaæ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ã€‚</li>
<li>æœ¬åœ°æ–¹æ³•æ ˆåˆ™æ˜¯ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„Nativeæ–¹æ³•æœåŠ¡ã€‚æœ‰çš„è™šæ‹Ÿæœºç›´æ¥å°±æŠŠæœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ã€‚</li>
</ol>
<p>æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰<br>å¯é€šè¿‡å‚æ•°-XX:MaxPermSizeè®¾ç½®</p>
<ol>
<li>çº¿ç¨‹å…±äº«å†…ç²—åŒºåŸŸï¼Œç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ï¼Œå³ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ï¼Œæ–¹æ³•åŒºä¹Ÿç§°ä¸ºæŒä¹…ä»£ï¼ˆPermanent Generationï¼‰</li>
<li>è™½ç„¶Javaè™šæ‹Ÿæœºè§„èŒƒæŠŠæ–¹æ³•åŒºæè¿°ä¸ºå †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ï¼Œä½†æ˜¯å®ƒå´æœ‰ä¸€ä¸ªåˆ«åå«Non-Heapï¼ˆéå †ï¼‰ï¼Œç›®çš„åº”è¯¥æ˜¯ä¸Javaå †åŒºåˆ†å¼€æ¥</li>
<li>å¦‚ä½•å®ç°æ–¹æ³•åŒºï¼Œå±äºè™šæ‹Ÿæœºçš„å®ç°ç»†èŠ‚ï¼Œä¸å—è™šæ‹Ÿæœºçº¦æŸè§„èŒƒã€‚</li>
<li>æ–¹æ³•å»ä¸»è¦æ–¹æ³•Javaç±»å®šä¹‰ä¿¡æ¯ï¼Œä¸åƒåœ¾å›æ”¶å…³ç³»ä¸å¤§ï¼Œæ–¹æ³•åŒºå¯ä»¥é€‰æ‹©ä¸å®ç°åƒåœ¾å›æ”¶ï¼Œä½†å¹¶ä¸æ˜¯æ²¡æœ‰åƒåœ¾å›æ”¶ã€‚</li>
<li>æ–¹æ³•åŒºåŸŸçš„å†…å­˜å›æ”¶ç›®æ ‡ä¸»è¦æ˜¯é’ˆå¯¹å¸¸é‡æ± çš„å›æ”¶å’Œå¯¹ç±»å‹çš„å¸è½½ã€‚</li>
<li>è¿è¡Œæ—¶å¸¸é‡ï¼Œä¹Ÿæ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œè™šæ‹ŸæœºåŠ è½½classåæŠŠå¸¸é‡æ± ä¸­çš„æ•°æ®æ”¾å…¥è¿è¡Œæ—¶å¸¸é‡æ± ã€‚</li>
</ol>
<p>è¿è¡Œæ—¶å¸¸é‡æ± </p>
<p>JDK1.6ä¹‹å‰å­—ç¬¦ä¸²å¸¸é‡æ± ä½äºæ–¹æ³•åŒºä¹‹ä¸­ã€‚JDK1.7å­—ç¬¦ä¸²å¸¸é‡æ± å·²ç»è¢«æŒªåˆ°å †ä¹‹ä¸­ã€‚<br>å¯é€šè¿‡å‚æ•°-XX:PermSizeå’Œâ€“XX:MaxPermSizeè®¾ç½®</p>
<ul>
<li>å¸¸é‡æ± ï¼ˆConstant Pool ï¼‰ï¼šå¸¸é‡æ± æ•°æ®ç¼–è¯‘æœŸè¢«ç¡®å®šï¼Œæ˜¯Classæ–‡ä»¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚å­˜å‚¨äº†ç±»ã€æ–¹æ³•ã€æ¥å£ä¸­çš„å¸¸é‡ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬å­—ç¬¦ä¸²å¸¸é‡ã€‚</li>
<li>å­—ç¬¦ä¸²æ± /å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString Poolï¼‰/ï¼ˆString Constant Poolï¼‰ï¼šæ˜¯å¸¸é‡æ± ä¸­ä¸€éƒ¨åˆ†ï¼Œå­˜å‚¨ç¼–è¯‘æœŸç±»ä¸­äº§ç”Ÿçš„å­—ç¬¦ä¸²ç±»å‹æ•°æ®ã€‚</li>
<li>è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰:æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œæ‰€æœ‰çº¿ç¨‹å…±äº«ã€‚è™šæ‹ŸæœºåŠ è½½ClassåæŠŠå¸¸é‡æ± ä¸­çš„æ•°æ®æ”¾å…¥åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ã€‚å¸¸é‡æ± ï¼šå¯ä»¥ç†è§£ä¸ºClassæ–‡ä»¶ä¹‹ä¸­çš„èµ„æºä»“åº“ï¼Œå®ƒæ˜¯Classæ–‡ä»¶ç»“æ„ä¸­ä¸å…¶ä»–é¡¹ç›®èµ„æºå…³è”æœ€å¤šçš„æ•°æ®ç±»å‹ã€‚</li>
</ul>
<ol>
<li>å¸¸é‡æ± ä¸­ä¸»è¦å­˜æ”¾ä¸¤å¤§ç±»å¸¸é‡ï¼šå­—é¢é‡ï¼ˆLiteralï¼‰å’Œç¬¦å·é¥®ç”¨ï¼ˆSymbolic Referenceï¼‰ã€‚</li>
<li>å­—é¢é‡ï¼šæ–‡æœ¬å­—ç¬¦ä¸²ã€å£°æ˜ä¸ºfinalçš„å¸¸é‡å€¼ç­‰ã€‚</li>
<li>ç¬¦å·å¼•ç”¨ï¼šç±»å’Œæ¥å£çš„å®Œå…¨é™å®šåï¼ˆFull Qualified Nameï¼‰ã€å­—æ®µçš„åç§°å’Œæè¿°ç¬¦ï¼ˆDescriptorï¼‰ã€æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦ã€‚</li>
</ol>
<p>ç›´æ¥å†…å­˜</p>
<p>å¯é€šè¿‡-XX:MaxDirectMemoryæŒ‡å®šï¼Œå¦‚æœä¸æŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸Javaå †çš„æœ€å¤§å€¼ï¼ˆ-Xmxï¼‰ä¸€æ ·ã€‚</p>
<ul>
<li>ç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰å¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸï¼Œä½†æ˜¯è¿™éƒ¨åˆ†å†…å­˜ä¹Ÿè¢«é¢‘ç¹çš„ä½¿ç”¨ï¼Œè€Œä¸”ä¹Ÿå¯èƒ½å¯¼è‡´OutOfMemoryErrorå¼‚å¸¸å‡ºç°ã€‚</li>
</ul>
<p>æ€»ç»“çš„ç®€å•ä¸€ç‚¹<br>Javaå †ï¼ˆJava Heapï¼‰<br>å¯é€šè¿‡å‚æ•°-Xms å’Œ -Xmxè®¾ç½®</p>
<ol>
<li>Javaå †æ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œæ˜¯Javaè™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ï¼ŒJavaå †åœ¨è™šæ‹Ÿæœºå¯åŠ¨ååˆ›å»º</li>
<li>Javaå †å”¯ä¸€çš„ç›®çš„æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½æ”¾åœ¨è¿™é‡Œ</li>
<li><p>Javaå †ä¸ºäº†æ›´å¥½çš„å›æ”¶å’Œåˆ†é…å†…å­˜ï¼Œå¯ä»¥ç»†åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼›å†ç»†è‡´ä¸€ç‚¹åˆ†ä¸ºEdenç©ºé—´ï¼ŒFrom Survivorç©ºé—´ï¼ŒTo Survivorç©ºé—´ã€‚</p>
<ul>
<li>æ–°ç”Ÿä»£ï¼šåŒ…æ‹¬EdenåŒºã€From SurvivoråŒºã€To SurvivoråŒºï¼Œç³»ç»Ÿé»˜è®¤å¤§å°ä¸ºEden:Survivor=8ï¼š1ã€‚</li>
<li>è€å¹´ä»£ï¼šåœ¨å¹´è½»ä»£ä¸­ç»å†äº†Næ¬¡åƒåœ¾å›æ”¶åä»ç„¶å­˜æ´»çš„å¯¹è±¡ï¼Œå°±ä¼šè¢«æ”¾åˆ°è€å¹´ä»£ä¸­ã€‚å› æ­¤ï¼Œå¯ä»¥è®¤ä¸ºè€å¹´ä»£ä¸­å­˜æ”¾çš„éƒ½æ˜¯ä¸€äº›ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€‚</li>
</ul>
</li>
</ol>
<p>Javaè™šæ‹Ÿæœºæ ˆï¼ˆStackï¼‰<br>å¯é€šè¿‡å‚æ•°æ ˆå¸§æ˜¯æ–¹æ³•è¿è¡ŒæœŸçš„åŸºç¡€æ•°æ®ç»“æ„ï¼Œæ ˆå®¹é‡å¯ç”±-Xssè®¾ç½®</p>
<ol>
<li>Javaè™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒã€‚</li>
<li>æ¯ä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºä¸­ä»å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚</li>
<li>è™šæ‹Ÿæœºæ ˆæ˜¯æ‰§è¡ŒJavaæ–¹æ³•çš„å†…å­˜æ¨¡å‹ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼šæ¯ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯</li>
</ol>
<p>æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰<br>å¯é€šè¿‡-XX:MaxPermSizeè®¾ç½®</p>
<ol>
<li>çº¿ç¨‹å…±äº«å†…å­˜åŒºåŸŸï¼Œç”¨äºå·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ï¼Œå³ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ï¼Œæ–¹æ³•åŒºä¹Ÿè¢«ç§°ä¸ºæŒä¹…ä»£ï¼ˆPermanent Generationï¼‰</li>
<li>æ–¹æ³•åŒºä¸»è¦å­˜æ”¾Javaç±»å®šä¹‰ä¿¡æ¯ï¼Œä¸åƒåœ¾å›æ”¶å…³ç³»ä¸å¤§ï¼Œæ–¹æ³•åŒºå¯ä»¥ç°åœ¨ä¸å®ç°åƒåœ¾å›æ”¶ï¼Œä½†ä¸æ˜¯æ²¡æœ‰åƒåœ¾å›æ”¶ã€‚</li>
<li>æ–¹æ³•åŒºåŸŸçš„å†…å­˜å›æ”¶ç›®æ ‡åªè¦æ˜¯é’ˆå¯¹å¸¸é‡æ± å’Œå †ç±»å‹çš„å¸è½½ã€‚</li>
<li><p>è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œä¹Ÿæ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œè™šæ‹ŸæœºåŠ è½½ClassåæŠŠå¸¸é‡æ± ä¸­å›½å‘¢çš„æ•°æ®æ”¾å…¥è¿è¡Œæ—¶å¸¸é‡æ± ã€‚</p>
</li>
<li><h3 id="ä»€ä¹ˆæ˜¯CASï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯CASï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯CASï¼Ÿ"></a>ä»€ä¹ˆæ˜¯CASï¼Ÿ</h3><p>CASï¼ˆcompare and swapï¼‰çš„ç¼©å†™ï¼Œä¸­æ–‡ç¿»è¯‘æˆæ¯”è¾ƒä¸äº¤æ¢ã€‚</p>
</li>
</ol>
<p>CASä¸é€šè¿‡JVMï¼Œç›´æ¥åˆ©ç”¨Javaæœ¬åœ°æ–¹æ³•JNIï¼ˆJava Native Interfaceä¸ºJavaæœ¬åœ°è°ƒç”¨ï¼‰ï¼Œç›´æ¥è°ƒç”¨CPUçš„cmpxchgæŒ‡ä»¤ã€‚</p>
<p>åˆ©ç”¨CPUçš„CASæŒ‡ä»¤ï¼ŒåŒæ—¶å€ŸåŠ©JNIæ¥å®ŒæˆJavaçš„éé˜»å¡ç®—æ³•ï¼Œå®ç°é™¢å­æ“ä½œã€‚å…¶ä»–è¿œç¦»æ“ä½œéƒ½æ˜¯åˆ©ç”¨ç±»ä¼¼çš„ç‰¹æ€§å®Œæˆçš„ã€‚</p>
<p>æ•´ä¸ªjava.util.concurrentéƒ½æ˜¯å»ºç«‹åœ¨CASä¹‹ä¸Šçš„ï¼Œå› æ­¤å¯¹äºsynchronizedçš„é˜»å¡ç®—æ³•ï¼ŒJ.U.Cåœ¨æ€§èƒ½ä¸Šæœ‰æ¥äº†å¾ˆå¤§çš„æå‡ã€‚</p>
<p>CASæ˜¯é¡¹ä¹è§‚é”æŠ€æœ¯ï¼Œå½“å¤šä¸ªçº¿ç¨‹éƒ½å°è¯•ä½¿ç”¨CASåŒæ—¶æ›´æ–°åŒä¸€ä¸ªå˜é‡æ—¶ï¼Œåªæœ‰å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹èƒ½æ›´æ–°å˜é‡çš„å€¼ï¼Œè€Œå…¶ä»–çº¿ç¨‹éƒ½å¤±è´¥ï¼Œå¤±è´¥çš„çº¿ç¨‹å¹¶ä¸ä¼šè¢«æŒ‚èµ·ï¼Œè€Œæ˜¯è¢«å‘ŠçŸ¥è¿™æ¬¡ç«äº‰ä¸­å¤±è´¥ï¼Œå¹¶å¯ä»¥å†æ¬¡å°è¯•ã€‚</p>
<h4 id="CASåº”ç”¨"><a href="#CASåº”ç”¨" class="headerlink" title="CASåº”ç”¨"></a>CASåº”ç”¨</h4><p>CASæœ‰3ä¸ªæ“ä½œæ•°ï¼Œå†…å­˜å€¼Vï¼Œæ—§çš„é¢„æœŸå€¼Aï¼Œè¦ä¿®æ”¹çš„æ–°å€¼Bï¼Œå½“ä¸”ä»…å½“é¢„æœŸå€¼Aå’Œå†…å­˜å€¼Vç›¸åŒæ—¶ï¼Œå°†å†…å­˜å€¼Vä¿®æ”¹ä¸ºBï¼Œå¦åˆ™ä»€ä¹ˆéƒ½ä¸åšã€‚</p>
<h4 id="CASä¼˜ç‚¹"><a href="#CASä¼˜ç‚¹" class="headerlink" title="CASä¼˜ç‚¹"></a>CASä¼˜ç‚¹</h4><p>ç¡®ä¿å¯¹å†…å­˜çš„è¯»-æ”¹-å†™æ“ä½œéƒ½æ˜¯åŸå­æ“ä½œæ‰§è¡Œ</p>
<h4 id="CASç¼ºç‚¹"><a href="#CASç¼ºç‚¹" class="headerlink" title="CASç¼ºç‚¹"></a>CASç¼ºç‚¹</h4><p>CASè™½ç„¶å¾ˆé«˜æ•ˆçš„è§£å†³åŸå­æ“ä½œï¼Œä½†æ˜¯CASä»ç„¶å­˜åœ¨ä¸‰å¤§é—®é¢˜ã€‚ABAé—®é¢˜ï¼Œå¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§å’Œåªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ</p>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ol>
<li>ä½¿ç”¨CASåœ¨çº¿ç¨‹å†²çªä¸¥é‡æ—¶ï¼Œä¼šå¤§å¹…é™ä½ç¨‹åºæ€§èƒ½ï¼›CASåªé€‚åˆäºçº¿ç¨‹å†²çªè¾ƒå°‘çš„æƒ…å†µä½¿ç”¨ã€‚</li>
<li>synchronizedåœ¨JDK1.6ä¹‹åï¼Œå·²ç»æ”¹è¿›ä¼˜åŒ–ã€‚synchronizedçš„åº•å±‚å®ç°ä¸»è¦ä¾é Lock-Freeé˜Ÿåˆ—ï¼ŒåŸºæœ¬æ€è·¯æ˜¯è‡ªæ—‹åé˜»å¡ï¼Œç«äº‰åˆ‡æ¢åç»§ç»­ç«äº‰é”ï¼Œç¨å¾®ç‰ºç‰²äº†å…¬å¹³æ€§ï¼Œä½†è·å¾—äº†é«˜ååé‡ã€‚åœ¨çº¿ç¨‹å†²çªè¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è·å¾—å’ŒCASç±»ä¼¼çš„æ€§èƒ½ï¼›è€Œçº¿ç¨‹å†²çªä¸¥é‡çš„æƒ…å†µä¸‹ï¼Œæ€§èƒ½è¿œé«˜äºCASã€‚</li>
</ol>
<h3 id="6-ä»€ä¹ˆæ˜¯ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Ÿ"><a href="#6-ä»€ä¹ˆæ˜¯ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Ÿ" class="headerlink" title="6. ä»€ä¹ˆæ˜¯ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Ÿ"></a>6. ä»€ä¹ˆæ˜¯ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Ÿ</h3><h4 id="æ‚²è§‚é”"><a href="#æ‚²è§‚é”" class="headerlink" title="æ‚²è§‚é”"></a>æ‚²è§‚é”</h4><p>Javaåœ¨JDK1.5ä¹‹å‰éƒ½æ˜¯é synchronizedå…³é”®å­—ä¿è¯åŒæ­¥çš„ï¼Œè¿™ç§é€šè¿‡ä½¿ç”¨ä¸€è‡´çš„é”å®šåè®®æ¥åè°ƒå¯¹å…±äº«çŠ¶æ€çš„è®¿é—®ï¼Œå¯ä»¥ç¡®ä¿æ— è®ºå“ªä¸ªçº¿ç¨‹æŒæœ‰å…±äº«å˜é‡çš„é”ï¼Œéƒ½é‡‡ç”¨ç‹¬å çš„æ–¹å¼æ¥è®¿é—®è¿™äº›å˜é‡ã€‚ç‹¬å é”å…¶å®å°±æ˜¯ä¸€ç§æ‚²è§‚é”ï¼Œæ‰€ä»¥è¯´synchronizeæ˜¯æ‚²è§‚é”ã€‚</p>
<h4 id="ä¹è§‚é”"><a href="#ä¹è§‚é”" class="headerlink" title="ä¹è§‚é”"></a>ä¹è§‚é”</h4><p>ä¹è§‚é”ï¼ˆOptimistic Lockingï¼‰å…¶å®æ˜¯ä¸€ç§æ€æƒ³ã€‚ç›¸å¯¹æ‚²è§‚é”è€Œè¨€ï¼Œä¹è§‚é”å‡è®¾è®¤ä¸ºæ•°æ®ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šé€ æˆå†²çªï¼Œæ‰€ä»¥åœ¨æ•°æ®è¿›è¡Œæäº¤æ›´æ–°çš„æ—¶å€™ï¼Œæ‰ä¼šæ­£å¼å¯¹æ•°æ®çš„å†²çªä¸å¦è¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœå‘ç°å†²çªäº†ï¼Œåˆ™è¿”å›ç”¨æˆ·é”™è¯¯çš„ä¿¡æ¯ï¼Œè®©ç”¨æˆ·å†³å®šå¦‚ä½•å»åšã€‚</p>
<h3 id="6-ä»€ä¹ˆæ˜¯åŸå­æ“ä½œï¼Ÿåœ¨Java-Concurrency-APIä¸­æœ‰å“ªäº›åŸå­ç±»ï¼ˆatomic-classesï¼‰ï¼Ÿ"><a href="#6-ä»€ä¹ˆæ˜¯åŸå­æ“ä½œï¼Ÿåœ¨Java-Concurrency-APIä¸­æœ‰å“ªäº›åŸå­ç±»ï¼ˆatomic-classesï¼‰ï¼Ÿ" class="headerlink" title="6. ä»€ä¹ˆæ˜¯åŸå­æ“ä½œï¼Ÿåœ¨Java Concurrency APIä¸­æœ‰å“ªäº›åŸå­ç±»ï¼ˆatomic classesï¼‰ï¼Ÿ"></a>6. ä»€ä¹ˆæ˜¯åŸå­æ“ä½œï¼Ÿåœ¨Java Concurrency APIä¸­æœ‰å“ªäº›åŸå­ç±»ï¼ˆatomic classesï¼‰ï¼Ÿ</h3><p>åŸå­æ“ä½œæ˜¯æŒ‡ä¸€ä¸ªä¸å—å…¶ä»–æ“ä½œå½±å“çš„æ“ä½œä»»ä½•å•å…ƒã€‚åŸå­æ“ä½œæ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹é¿å…æ•°æ®ä¸ä¸€è‡´å¿…é¡»çš„æ‰‹æ®µ</p>
<p>i++å¹¶ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œæ‰€ä»¥å½“ä¸€ä¸ªçº¿ç¨‹è¯»å–å®ƒçš„å€¼å¹¶+1æ—¶ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹æœ‰å¯èƒ½ä¼šè¯»åˆ°ä¹‹å‰çš„å€¼ï¼Œè¿™å°±ä¼šå¼•å‘é”™è¯¯ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¿…é¡»ä¿è¯å¢åŠ æ“ä½œæ˜¯åŸå­çš„ï¼Œåœ¨JDK1.5ä¹‹å‰æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒæ­¥æŠ€æœ¯åšåˆ°è¿™ä¸€ç‚¹ã€‚</p>
<p>åœ¨JDK1.5ä¹‹åï¼Œjava.util.concurrent.atomicåŒ…æä¾›äº†intå’Œlongç±»å‹çš„è£…ç±»ï¼Œå®ƒä»¬å¯ä»¥è‡ªåŠ¨çš„ä¿è¯å¯¹äºä»–ä»¬çš„æ“ä½œæ˜¯åŸå­çš„å¹¶ä¸”ä¸éœ€è¦ä½¿ç”¨åŒæ­¥ã€‚</p>
<h3 id="7-ä»€ä¹ˆæ˜¯Executorsæ¡†æ¶ï¼Ÿ"><a href="#7-ä»€ä¹ˆæ˜¯Executorsæ¡†æ¶ï¼Ÿ" class="headerlink" title="7. ä»€ä¹ˆæ˜¯Executorsæ¡†æ¶ï¼Ÿ"></a>7. ä»€ä¹ˆæ˜¯Executorsæ¡†æ¶ï¼Ÿ</h3><p>Executoræ¡†æ¶åŒjava.util.concurrent.Executoræ¥å£åœ¨Java5ä¸­è¢«å¼•å…¥ã€‚</p>
<p>Executoræ¡†æ¶æ˜¯ä¸€ä¸ªæ ¹æ®ä¸€ç»„æ‰§è¡Œç­–ç•¥è°ƒç”¨ï¼Œè°ƒåº¦ï¼Œæ‰§è¡Œå’Œæ§åˆ¶çš„å¼‚æ­¥ä»»åŠ¡æ¡†æ¶ã€‚</p>
<p>æ— é™åˆ¶çš„åˆ›å»ºçº¿ç¨‹ä¼šå¼•èµ·åº”ç”¨ç¨‹åºå†…å­˜æº¢å‡ºã€‚æ‰€ä»¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± æ˜¯ä¸ªæ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºå¯ä»¥é™åˆ¶çº¿ç¨‹çš„æ•°é‡å¹¶ä¸”å¯ä»¥å›æ”¶å†åˆ©ç”¨è¿™äº›çº¿ç¨‹ã€‚</p>
<p>åˆ©ç”¨Executoræ¡†æ¶å¯ä»¥éå¸¸æ–¹ä¾¿çš„åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œ</p>
<p>Javaé€šè¿‡Executorsæä¾›å››ç§çº¿ç¨‹æ± ï¼Œåˆ†åˆ«ä¸ºï¼š</p>
<p>newCachedThreadPoolåˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çº¿ç¨‹æ± ï¼Œå¦‚æœçº¿ç¨‹æ± é•¿åº¦è¶…è¿‡å¤„ç†éœ€æ±‚ï¼Œå¯çµæ´»å›æ”¶ç©ºé—²çº¿ç¨‹ï¼Œè‹¥æ— å¯å›æ”¶ï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹ã€‚</p>
<p>newFixedThreadPoolåˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œæ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œã€‚</p>
<p>newSingleThreadExecutoråˆ›å»ºä¸€ä¸ªä½†çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± ï¼Œå®ƒåªä¼šç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåºï¼ˆFIFOï¼ŒLIFOï¼Œä¼˜å…ˆçº§ï¼‰æ‰§è¡Œã€‚</p>
<h3 id="8-ä»€ä¹ˆæ˜¯é˜»å¡é˜Ÿåˆ—ï¼Ÿå¦‚ä½•ä½¿ç”¨é˜»å¡é˜Ÿåˆ—æ¥å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Ÿ"><a href="#8-ä»€ä¹ˆæ˜¯é˜»å¡é˜Ÿåˆ—ï¼Ÿå¦‚ä½•ä½¿ç”¨é˜»å¡é˜Ÿåˆ—æ¥å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Ÿ" class="headerlink" title="8.ä»€ä¹ˆæ˜¯é˜»å¡é˜Ÿåˆ—ï¼Ÿå¦‚ä½•ä½¿ç”¨é˜»å¡é˜Ÿåˆ—æ¥å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Ÿ"></a>8.ä»€ä¹ˆæ˜¯é˜»å¡é˜Ÿåˆ—ï¼Ÿå¦‚ä½•ä½¿ç”¨é˜»å¡é˜Ÿåˆ—æ¥å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Ÿ</h3><p>JDK7æä¾›äº†7ä¸ªé˜»å¡é˜Ÿåˆ—ã€‚ï¼ˆä¹Ÿå±äºå¹¶å‘å®¹å™¨ï¼‰</p>
<ol>
<li>ArrayBlockingQueue: ä¸€ä¸ªç”±æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li>LinkedBlockingQueueï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li>PriorityBlockingQueue: ä¸€ä¸ªæ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li>DelayQueueï¼šä¸€ä¸ªä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li>SynchronousQueueï¼šä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ã€‚</li>
<li>LinkedTransferQueueï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li>LinkedBlockingDueueï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—ã€‚</li>
</ol>
<h4 id="ä»€ä¹ˆæ˜¯é˜»å¡é˜Ÿåˆ—ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯é˜»å¡é˜Ÿåˆ—ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯é˜»å¡é˜Ÿåˆ—ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯é˜»å¡é˜Ÿåˆ—ï¼Ÿ</h4><p>é˜»å¡é˜Ÿåˆ—æ˜¯ä¸€ä¸ªåœ¨é˜Ÿåˆ—åŸºç¡€ä¸Šåˆæ”¯æŒäº†ä¸¤ä¸ªé™„åŠ æ“ä½œçš„é˜Ÿåˆ—ã€‚</p>
<p>2ä¸ªé™„åŠ æ“ä½œï¼š</p>
<p>æ”¯æŒé˜»å¡çš„æ’å…¥æ–¹æ³•ï¼šé˜Ÿåˆ—æ»¡æ—¶ï¼Œé˜Ÿåˆ—ä¼šé˜»å¡æ’å…¥å…ƒç´ çš„çº¿ç¨‹ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸æ»¡ã€‚<br>æ”¯æŒé˜»å¡çš„ç§»é™¤æ–¹æ³•ï¼šé˜Ÿåˆ—ç©ºæ—¶ï¼Œè·å–å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å˜ä¸ºéç©ºã€‚</p>
<p>é˜»å¡é˜Ÿåˆ—çš„åº”ç”¨åœºæ™¯</p>
<p>é˜»å¡é˜Ÿåˆ—å¸¸ç”¨äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åœºæ™¯ï¼Œç”Ÿäº§è€…æ˜¯å‘é˜Ÿåˆ—é‡Œæ·»åŠ å…ƒç´ çš„çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…æ˜¯ä»é˜Ÿåˆ—é‡Œå–å…ƒç´ çš„çº¿ç¨‹ã€‚ç®€è€Œè¨€ä¹‹ï¼Œé˜»å¡é˜Ÿåˆ—æ˜¯ç”Ÿäº§è€…ç”¨æ¥å­˜æ”¾å…ƒç´ ã€æ¶ˆè´¹è€…ç”¨æ¥è·å–å…ƒç´ çš„å®¹å™¨ã€‚</p>
<p>Javaé‡Œçš„é˜»å¡é˜Ÿåˆ—ï¼Œå¦‚ä¸‹</p>
<ol>
<li>ArrayBlockingQueue æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
</ol>
<p>æ­¤é˜Ÿåˆ—æŒ‰ç…§å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹ä¸ä¿è¯çº¿ç¨‹å…¬å¹³çš„è®¿é—®é˜Ÿåˆ—ï¼Œå³å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œé‚£ä¹ˆè¢«é˜»å¡åœ¨å¤–é¢çš„çº¿ç¨‹é˜Ÿåˆ—è®¿é—®çš„é¡ºåºæ˜¯ä¸èƒ½ä¿è¯çº¿ç¨‹å…¬å¹³ï¼ˆå³å…ˆé˜»å¡ï¼Œå…ˆæ’å…¥çš„ï¼‰ã€‚</p>
<ol>
<li>LinkedBlockingQueueä¸€ä¸ªç”±é“¾è¡¨ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—</li>
</ol>
<p>æ­¤é˜Ÿåˆ—æŒ‰ç…§å…ˆè¿›æ¶ˆé™¤çš„åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åº</p>
<ol>
<li><p>PriorityBlockingQueueæ”¯æŒä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—</p>
</li>
<li><p>DelayQueueæ”¯æŒå»¶æ—¶è·å–å…ƒç´ çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œå³å¯ä»¥æŒ‡å®šå¤šä¹…æ‰èƒ½ä»é˜Ÿåˆ—ä¸­è·å–å½“å‰å…ƒç´ </p>
</li>
<li><p>SynchronousQueueä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ¯ä¸€ä¸ªputå¿…é¡»ç­‰å¾…ä¸€ä¸ªtakeæ“ä½œï¼Œå¦åˆ™ä¸èƒ½ç»§ç»­æ·»åŠ å…ƒç´ ã€‚å¹¶ä¸”ä»–æ”¯æŒå…¬å¹³è®¿é—®é˜Ÿåˆ—</p>
</li>
<li><p>LinkedTransferQueueç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æ— ç•Œé˜»å¡TransferQueueé˜Ÿåˆ—ã€‚ç›¸å¯¹äºå…¶ä»–é˜»å¡é˜Ÿåˆ—ï¼Œå¤šäº†tryTransferå’Œtransferæ–¹æ³•ã€‚</p>
</li>
</ol>
<p>transferæ–¹æ³•</p>
<p>å¦‚æœå½“å‰æœ‰æ¶ˆè´¹è€…æ­£åœ¨ç­‰å¾…æ¥å—å…ƒç´ ï¼ˆtakeæˆ–è€…å¾…æ—¶é—´é™åˆ¶çš„pollæ–¹ï¼‰ï¼Œtransferå¯ä»¥æŠŠç”Ÿäº§è€…ä¼ å…¥çš„å…ƒç´ ç«‹åˆ»ä¼ ç»™æ¶ˆè´¹è€…ã€‚å¦‚æœæ²¡æœ‰æ¶ˆè´¹è€…ç­‰å¾…æ¥æ”¶å…ƒç´ ï¼Œåˆ™å°†å…ƒç´ æ”¾åœ¨é˜Ÿåˆ—çš„tailèŠ‚ç‚¹ï¼Œå¹¶ç­‰åˆ°è¯¥å…ƒç´ è¢«æ¶ˆè´¹è€…æ¶ˆè´¹åŠ›æ‰è¿”å›ã€‚</p>
<p>tryTransferæ–¹æ³•</p>
<p>ç”¨æ¥è¯•æ¢ç”Ÿäº§è€…ä¼ å…¥çš„å…ƒç´ èƒ½å¦ç›´æ¥ä¼ ç»™æ¶ˆè´¹è€…ã€‚å¦‚æœæ²¡æœ‰æ¶ˆè´¹è€…åœ¨ç­‰å¾…ï¼Œåˆ™è¿”å›falseã€‚å’Œä¸Šè¿°æ–¹æ³•çš„åŒºåˆ«æ˜¯è¯¥æ–¹æ³•æ— è®ºæ¶ˆè´¹è€…æ˜¯å¦æ¥æ”¶ï¼Œæ–¹æ³•ç«‹å³è¿”å›ã€‚è€Œtransferæ–¹æ³•æ˜¯å¿…é¡»ç­‰åˆ°æ¶ˆè´¹è€…æ¶ˆè´¹äº†æ‰è¿”å›ã€‚</p>
<ol>
<li>LinkedBlockingDequeé“¾è¡¨ç»“æ„çš„åŒå‘é˜»å¡é˜Ÿåˆ—ï¼Œä¼˜åŠ¿åœ¨äºå¤šçº¿ç¨‹å…¥é˜Ÿæ—¶ï¼Œå‡å°‘ä¸€åŠçš„ç«äº‰ã€‚</li>
</ol>
<p>å¦‚ä½•ä½¿ç”¨é˜»å¡é˜Ÿåˆ—æ¥å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Ÿ</p>
<p>é€šçŸ¥æ¨¡å¼å®ç°ï¼šæ‰€è°“é€šçŸ¥æ¨¡å¼ï¼ŒåŠæ—¶å½“ç”Ÿäº§è€…å¾€æ»¡çš„é˜Ÿåˆ—é‡Œæ·»åŠ å…ƒç´ æ—¶ä¼šé˜»å¡ç”Ÿäº§è€…ï¼Œå½“æ¶ˆè´¹è€…æ¶ˆè´¹é‡Œä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„å…ƒç´ åï¼Œä¼šé€šçŸ¥ç”Ÿäº§è€…å½“å‰é˜Ÿåˆ—å¯ç”¨ã€‚</p>
<p>ä½¿ç”¨BlockingQueueè§£å†³ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜</p>
<p>ä¸ºä»€ä¹ˆBlockingQueueé€‚åˆè§£å†³ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜</p>
<p>ä»»ä½•æœ‰æ•ˆçš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜è§£å†³æ–¹æ¡ˆé€šè¿‡éƒ½æ˜¯é€šè¿‡æ§åˆ¶ç”Ÿäº§è€…put()æ–¹æ³•ï¼ˆç”Ÿäº§èµ„æºï¼‰å’Œæ¶ˆè´¹è€…take()æ–¹æ³•ï¼ˆæ¶ˆè´¹èµ„æºï¼‰çš„è°ƒç”¨æ¥å®ç°çš„ï¼Œä¸€æ—¦ä½ å®ç°äº†å¯¹æ–¹æ³•çš„é˜»å¡æ§åˆ¶ï¼Œé‚£ä¹ˆä½ å°±å°†è§£å†³è¯¥é—®é¢˜ã€‚</p>
<p>Javaé€šè¿‡BlockingQueueæä¾›äº†å¼€ç®±å³ç”¨çš„æ”¯æŒæ¥æ§åˆ¶è¿™äº›æ–¹æ³•çš„è°ƒç”¨ï¼ˆä¸€ä¸ªçº¿ç¨‹åˆ›å»ºèµ„æºï¼Œå¦ä¸€ä¸ªæ¶ˆè´¹èµ„æºï¼‰ã€‚Java.util.concurrentåŒ…ä¸‹çš„BlockingQueueæ¥å£æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å¯ç”¨äºå­˜å–å¯¹è±¡çš„é˜Ÿåˆ—ã€‚</p>
<p>BlockingQueueæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œæ”¯æŒä¸€ä¸ªçº¿ç¨‹å¾€é‡Œå­˜èµ„æºï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä»é‡Œå–èµ„æºã€‚è¿™æ­£å¼è§£å†³ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜æ‰€éœ€è¦çš„ï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬å¼€å§‹è§£å†³è¯¥é—®é¢˜å§ã€‚</p>
<h4 id="ç”Ÿäº§è€…"><a href="#ç”Ÿäº§è€…" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h4><p>ä»¥ä¸‹ä»£ç ç”¨äºç”Ÿäº§è€…çº¿ç¨‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">package cn.choleece.threads;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.BlockingQueue;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * ç”Ÿäº§è€…</span><br><span class="line"> *</span><br><span class="line"> * @author choleece</span><br><span class="line"> * @date 2018/6/25</span><br><span class="line"> */</span><br><span class="line">public class Producer implements Runnable &#123;</span><br><span class="line"></span><br><span class="line">    protected BlockingQueue&lt;Object&gt; blockingQueue;</span><br><span class="line"></span><br><span class="line">    public Producer(BlockingQueue&lt;Object&gt; blockingQueue) &#123;</span><br><span class="line">        this.blockingQueue = blockingQueue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            while (true) &#123;</span><br><span class="line">                Object justProduced = getResource();</span><br><span class="line">                blockingQueue.put(justProduced);</span><br><span class="line">                System.out.println(&quot;ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==&quot; + blockingQueue.size());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            System.out.println(&quot;ç”Ÿäº§è€… å†™ ä¸­æ–­&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Object getResource() &#123;</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            Thread.sleep(100);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            System.out.println(&quot;ç”Ÿäº§è€… è¯» ä¸­æ–­&quot;);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return new Object();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¶ˆè´¹è€…</p>
<p>ä»¥ä¸‹ä»£ç ç”¨äºæ¶ˆè´¹è€…çº¿ç¨‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">package cn.choleece.threads;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.BlockingQueue;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * æ¶ˆè´¹è€…</span><br><span class="line"> *</span><br><span class="line"> * @author choleece</span><br><span class="line"> * @date 2018/6/25</span><br><span class="line"> */</span><br><span class="line">public class Consumer implements Runnable &#123;</span><br><span class="line"></span><br><span class="line">    protected BlockingQueue&lt;Object&gt; blockingQueue;</span><br><span class="line"></span><br><span class="line">    public Consumer(BlockingQueue&lt;Object&gt; blockingQueue) &#123;</span><br><span class="line">        this.blockingQueue = blockingQueue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            while (true) &#123;</span><br><span class="line">                Object obj = blockingQueue.take();</span><br><span class="line">                System.out.println(&quot;æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š&quot; + blockingQueue.size());</span><br><span class="line">                take(obj);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (InterruptedException ex) &#123;</span><br><span class="line">            System.out.println(&quot;æ¶ˆè´¹è€… ä¸­æ–­&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void take(Object obj) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Thread.sleep(100);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(&quot;æ¶ˆè´¹è€… è¯» ä¸­æ–­&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;æ¶ˆè´¹å¯¹è±¡ï¼š&quot; + obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•è¯¥è§£å†³æ–¹æ¡ˆæ˜¯å¦è¿è¡Œæ­£å¸¸</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">package cn.choleece.threads;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.BlockingQueue;</span><br><span class="line">import java.util.concurrent.LinkedBlockingQueue;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * å¯åŠ¨çº¿ç¨‹</span><br><span class="line"> *</span><br><span class="line"> * @author choleece</span><br><span class="line"> * @date 2018/6/25</span><br><span class="line"> */</span><br><span class="line">public class PCExample &#123;</span><br><span class="line">    public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">        int proNum = 4, cusNum = 3;</span><br><span class="line"></span><br><span class="line">        BlockingQueue&lt;Object&gt; blockingQueue = new LinkedBlockingQueue&lt;Object&gt;(5);</span><br><span class="line"></span><br><span class="line">        for (int i = 0; i &lt; proNum; i++) &#123;</span><br><span class="line">            new Thread(new Producer(blockingQueue)).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        for (int i = 0; i &lt; cusNum ; i++) &#123;</span><br><span class="line">            new Thread(new Consumer(blockingQueue)).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;ä¸»çº¿ç¨‹&quot;);</span><br><span class="line">        Thread.sleep(1000);</span><br><span class="line">        System.out.println(&quot;åœ¨æˆ‘ä¹‹åå°±ç»“æŸäº†&quot;);</span><br><span class="line"></span><br><span class="line">        System.exit(0);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">ä¸»çº¿ç¨‹</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==3</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š3</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š2</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š1</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==4</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==2</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==3</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==2</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@6ca1879</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@24e07882</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@1da459ca</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š3</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š4</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==5</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==4</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==3</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š2</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==3</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==4</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@2a27926e</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@80df6d0</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==5</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š4</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==5</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š4</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@199bcea6</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š3</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==4</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@c327309</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==5</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==5</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š4</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@2e1813f2</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š4</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==5</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@5c9953f1</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š4</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==5</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@6b1a9855</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@4930fceb</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==5</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==5</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š4</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š4</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@52da10a1</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==5</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š5</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@1fef2c64</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š4</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==5</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@4c99d9dc</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š4</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==5</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@6d0f6939</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š4</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==5</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@7833f23f</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š4</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==5</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@5a3b96c3</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š4</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==5</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@2aa674c0</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š4</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==5</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@67067c0b</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š4</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==5</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@345289f5</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š4</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==5</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@3cb6acbe</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š4</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==5</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@291f03a4</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š5</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==5</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@b35671a</span><br><span class="line">æ¶ˆè´¹å¯¹è±¡ï¼šjava.lang.Object@3eebec91</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š4</span><br><span class="line">æ¶ˆè´¹è€…é˜Ÿåˆ—å¤§å°ï¼š5</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==5</span><br><span class="line">ç”Ÿäº§è€…èµ„æºé˜Ÿåˆ—å¤§å°==5</span><br><span class="line">åœ¨æˆ‘ä¹‹åå°±ç»“æŸäº†</span><br></pre></td></tr></table></figure>
<p>ä»è¾“å‡ºç»“æœä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°é˜Ÿåˆ—å¤§å°æ°¸è¿œä¸ä¼šè¶…è¿‡5ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹æ¶ˆè´¹äº†ç”Ÿäº§è€…ç”Ÿäº§çš„èµ„æºã€‚</p>
<h3 id="9-ä»€ä¹ˆæ˜¯Callableå’ŒFutureï¼Ÿ"><a href="#9-ä»€ä¹ˆæ˜¯Callableå’ŒFutureï¼Ÿ" class="headerlink" title="9. ä»€ä¹ˆæ˜¯Callableå’ŒFutureï¼Ÿ"></a>9. ä»€ä¹ˆæ˜¯Callableå’ŒFutureï¼Ÿ</h3><p>Callableå’ŒFutureæ˜¯æ¯”è¾ƒæœ‰è¶£çš„ä¸€å¯¹ç»„åˆã€‚å½“æˆ‘ä»¬éœ€è¦è·å–çº¿ç¨‹çš„æ‰§è¡Œç»“æœæ—¶ï¼Œå°±éœ€è¦ç”¨åˆ°ä»–ä»¬ã€‚Callableç”¨äºäº§ç”Ÿç»“æœï¼ŒFutureç”¨äºè·å–ç»“æœã€‚</p>
<p>Callableæ¥å£ä½¿ç”¨æ³›å‹å»å®šä¹‰å®ƒçš„è¿”å›ç±»å‹ï¼ŒExecutorsç±»æä¾›ç±»ä¸€äº›æœ‰ç”¨çš„æ–¹æ³•å»åœ¨çº¿ç¨‹æ± ä¸­æ‰§è¡ŒCallableå†…çš„ä»»åŠ¡ã€‚ç”±äºCallableä»»åŠ¡æ˜¯å¹¶è¡Œçš„ï¼Œå¿…é¡»ç­‰å¾…å®ƒè¿”å›çš„ç»“æœã€‚java.util.concurrent.Futureå¯¹è±¡è§£å†³ç±»è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>åœ¨çº¿ç¨‹æ± æäº¤Callableä»»åŠ¡åè¿”å›ç±»ä¸€ä¸ªFutureå¯¹è±¡ï¼Œä½¿ç”¨å®ƒå¯ä»¥ç›´åˆ°Callableä»»åŠ¡çš„çŠ¶æ€å’Œå¾—åˆ°Callableè¿”å›çš„æ‰§è¡Œç»“æœã€‚Futureæä¾›äº†get()æ–¹æ³•ï¼Œç­‰å¾…Callableç»“æŸå¹¶è·å–å®ƒçš„æ‰§è¡Œç»“æœã€‚</p>
<p>ä»£ç ç¤ºä¾‹</p>
<p>Callableæ˜¯ä¸€ä¸ªç»“æ„ï¼Œå®ƒåªåŒ…å«ä¸€ä¸ªcal()æ–¹æ³•ã€‚Callableæ˜¯ä¸€ä¸ªè¿”å›ç»“æœå¹¶ä¸”å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»»åŠ¡ã€‚</p>
<p>ä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥å°†Callableæ¯”ä½œä¸€ä¸ªRunnableæ¥å£ï¼Œè€ŒCallableçš„call()æ–¹æ³•åˆ™ç±»ä¼¼ä¸Runnableçš„run()æ–¹æ³•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">package cn.choleece.threads;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * callable &amp; future</span><br><span class="line"> * @author choleece</span><br><span class="line"> * @date 2018/6/25</span><br><span class="line"> */</span><br><span class="line">public class CallableFutureTest &#123;</span><br><span class="line">    public static void main(String[] args) throws InterruptedException, ExecutionException &#123;</span><br><span class="line">        System.out.println(&quot;start main thread&quot;);</span><br><span class="line"></span><br><span class="line">        ExecutorService service = Executors.newFixedThreadPool(2);</span><br><span class="line"></span><br><span class="line">        // æ–°å»ºä¸€ä¸ªcallableä»»åŠ¡ï¼Œå¹¶å°†å…¶æäº¤åˆ°ExecutorServiceï¼Œå°†è¿”å›ä¸€ä¸ªæè¿°ä»»åŠ¡æƒ…å†µçš„Future</span><br><span class="line">        Callable&lt;String&gt; callable = new Callable&lt;String&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public String call() throws Exception &#123;</span><br><span class="line">                System.out.println(&quot;start new thread&quot;);</span><br><span class="line">                Thread.sleep(5000);</span><br><span class="line">                System.out.println(&quot;end new thread&quot;);</span><br><span class="line">                return &quot;æˆ‘æ˜¯è¿”å›çš„å†…å®¹&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Future&lt;String&gt; future = service.submit(callable);</span><br><span class="line">        Thread.sleep(1000);</span><br><span class="line">        String retn = future.get();</span><br><span class="line">        // å…³é—­çº¿ç¨‹æ± </span><br><span class="line">        service.shutdown();</span><br><span class="line">        System.out.println(retn + &quot;------end main thread&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ§åˆ¶å°æ‰“å°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">start main thread</span><br><span class="line">start new thread</span><br><span class="line">end new thread</span><br><span class="line">æˆ‘æ˜¯è¿”å›çš„å†…å®¹------end main thread</span><br></pre></td></tr></table></figure>
<h3 id="10-ä»€ä¹ˆæ˜¯FutureTask"><a href="#10-ä»€ä¹ˆæ˜¯FutureTask" class="headerlink" title="10. ä»€ä¹ˆæ˜¯FutureTask?"></a>10. ä»€ä¹ˆæ˜¯FutureTask?</h3><p>FutureTaskå¯ç”¨äºå¼‚æ­¥è·å–æ‰§è¡Œç»“æœæˆ–å–æ¶ˆæ‰§è¡Œä»»åŠ¡çš„åœºæ™¯ã€‚é€šè¿‡ä¼ å…¥Runnableæˆ–è€…Callableçš„ä»»åŠ¡ç»™FutureTaskï¼Œç›´æ¥è°ƒç”¨å…¶runæ–¹æ³•æˆ–è€…æ”¾å…¥çº¿ç¨‹æ± æ‰§è¡Œï¼Œä¹‹åå¯ä»¥å¤–éƒ¨é€šè¿‡FutureTaskçš„getæ–¹æ³•å¼‚æ­¥è·å–æ‰§è¡Œç»“æœï¼Œå› æ­¤ï¼ŒFutureTaskéå¸¸é€‚åˆç”¨äºè€—æ—¶çš„è®¡ç®—ï¼Œä¸»çº¿ç¨‹å¯ä»¥åœ¨å®Œæˆè‡ªå·±çš„ä»»åŠ¡åï¼Œå†å»è·å–ç»“æœã€‚å¦å¤–ï¼ŒFutureTaskè¿˜å¯ä»¥ç¡®ä¿å³ä½¿è°ƒç”¨äº†å¤šæ¬¡runæ–¹æ³•ï¼Œå®ƒéƒ½åªä¼šæ‰§è¡Œä¸€æ¬¡Runnableæˆ–è€…Callableä»»åŠ¡ï¼Œæˆ–è€…é€šè¿‡cancelå–æ¶ˆFutureTaskçš„æ‰§è¡Œç­‰ã€‚</p>
<ol>
<li>æ‰§è¡Œå¤šä»»åŠ¡è®¡ç®—</li>
</ol>
<p>FutureTaskæ‰§è¡Œå¤šä»»åŠ¡è®¡ç®—çš„ä½¿ç”¨åœºæ™¯</p>
<p>åˆ©ç”¨FutureTaskå’ŒExecutorServiceï¼Œå¯ä»¥ç”¨å¤šçº¿ç¨‹çš„æ–¹å¼æäº¤è®¡ç®—ä»»åŠ¡ï¼Œä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œå½“ä¸»çº¿ç¨‹éœ€è¦å­çº¿ç¨‹çš„è®¡ç®—ç»“æœæ—¶ï¼Œå†å¼‚æ­¥è·å–å­çº¿ç¨‹çš„æ‰§è¡Œç»“æœã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">package cn.choleece.threads;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *</span><br><span class="line"> * æ‰§è¡Œå¤šä»»åŠ¡è®¡ç®—</span><br><span class="line"> * @author choleece</span><br><span class="line"> * @date 2018/6/25</span><br><span class="line"> */</span><br><span class="line">public class FutureTaskForMultiCompute &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        FutureTaskForMultiCompute inst = new FutureTaskForMultiCompute();</span><br><span class="line"></span><br><span class="line">        // åˆ›å»ºä»»åŠ¡é›†åˆ</span><br><span class="line">        List&lt;FutureTask&lt;Integer&gt;&gt; taskList = new ArrayList&lt;FutureTask&lt;Integer&gt;&gt;();</span><br><span class="line"></span><br><span class="line">        // åˆ›å»ºçº¿ç¨‹æ± </span><br><span class="line">        ExecutorService exec = Executors.newFixedThreadPool(5);</span><br><span class="line">        for (int i = 0; i &lt; 10; i++) &#123;</span><br><span class="line">            // ä¼ å…¥callableå¯¹è±¡åˆ›å»ºFutureTaskå¯¹è±¡</span><br><span class="line">            FutureTask&lt;Integer&gt; ft = new FutureTask&lt;Integer&gt;(inst.new ComputeClass(i, &quot;&quot; + i));</span><br><span class="line">            taskList.add(ft);</span><br><span class="line">            // æäº¤ç»™çº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡ï¼Œä¹Ÿå¯ç”¨execçš„invokeAll(taskList)æ–¹æ³•ä¸€æ¬¡æ€§æäº¤ç´ æœ‰ä»»åŠ¡</span><br><span class="line">            exec.submit(ft);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;æ‰€æœ‰è®¡ç®—ä»»åŠ¡æäº¤å®Œæ¯•ï¼Œä¸»çº¿ç¨‹æ¥ç€å¹²å…¶ä»–çš„äº‹æƒ…&quot;);</span><br><span class="line"></span><br><span class="line">        // å¼€å§‹ç»Ÿè®¡å„è®¡ç®—çº¿ç¨‹çš„ç»“æœ</span><br><span class="line">        Integer totalResult = 0;</span><br><span class="line">        for (FutureTask&lt;Integer&gt; ft : taskList) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                // FutureTaskçš„get()æ–¹æ³•ä¼šè‡ªåŠ¨é˜»å¡ï¼Œç›´åˆ°è·å–è®¡ç®—ç»“æœä¸ºæ­¢</span><br><span class="line">                totalResult += ft.get();</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; catch (ExecutionException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        exec.shutdown();</span><br><span class="line">        System.out.println(&quot;å¤šä»»åŠ¡è®¡ç®—åçš„æ€»ç»“æœæ˜¯ï¼š&quot; + totalResult);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private class ComputeClass implements Callable&lt;Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">        private Integer result = 0;</span><br><span class="line"></span><br><span class="line">        private String taskName = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">        public ComputeClass(Integer result, String taskName) &#123;</span><br><span class="line">            this.result = result;</span><br><span class="line">            this.taskName = taskName;</span><br><span class="line">            System.out.println(&quot;ç”Ÿæˆå­çº¿ç¨‹ä»»åŠ¡ï¼š&quot; + taskName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public String getTaskName() &#123;</span><br><span class="line">            return taskName;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public Integer call() throws Exception &#123;</span><br><span class="line">            for (int i = 0; i &lt; 100; i++) &#123;</span><br><span class="line">                result += i;</span><br><span class="line">            &#125;</span><br><span class="line">            // ä¼‘çœ 5ç§’é’Ÿï¼Œè§‚å¯Ÿä¸»çº¿ç¨‹è¡Œä¸ºï¼Œé¢„æœŸçš„ç»“æœæ˜¯ä¸»çº¿ç¨‹ä¼šç»§ç»­æ‰§è¡Œï¼Œåˆ°è¦å–åˆ°FutureTaskçš„ç»“æœæ—¶ç­‰å¾…ç›´è‡³å®Œæˆ</span><br><span class="line">            Thread.sleep(5000);</span><br><span class="line">            System.out.println(&quot;å­çº¿ç¨‹è®¡ç®—ä»»åŠ¡ï¼š &quot; + taskName + &quot; è®¡ç®—å®Œæˆ&quot;);</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ§åˆ¶å°æ‰“å°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ç”Ÿæˆè‡ªçº¿ç¨‹ä»»åŠ¡ï¼š0</span><br><span class="line">ç”Ÿæˆè‡ªçº¿ç¨‹ä»»åŠ¡ï¼š1</span><br><span class="line">ç”Ÿæˆè‡ªçº¿ç¨‹ä»»åŠ¡ï¼š2</span><br><span class="line">ç”Ÿæˆè‡ªçº¿ç¨‹ä»»åŠ¡ï¼š3</span><br><span class="line">ç”Ÿæˆè‡ªçº¿ç¨‹ä»»åŠ¡ï¼š4</span><br><span class="line">ç”Ÿæˆè‡ªçº¿ç¨‹ä»»åŠ¡ï¼š5</span><br><span class="line">ç”Ÿæˆè‡ªçº¿ç¨‹ä»»åŠ¡ï¼š6</span><br><span class="line">ç”Ÿæˆè‡ªçº¿ç¨‹ä»»åŠ¡ï¼š7</span><br><span class="line">ç”Ÿæˆè‡ªçº¿ç¨‹ä»»åŠ¡ï¼š8</span><br><span class="line">ç”Ÿæˆè‡ªçº¿ç¨‹ä»»åŠ¡ï¼š9</span><br><span class="line">æ‰€æœ‰è®¡ç®—ä»»åŠ¡æäº¤å®Œæ¯•ï¼Œä¸»çº¿ç¨‹æ¥ç€å¹²å…¶ä»–çš„äº‹æƒ…</span><br><span class="line">å­çº¿ç¨‹è®¡ç®—ä»»åŠ¡ï¼š 0 è®¡ç®—å®Œæˆ</span><br><span class="line">å­çº¿ç¨‹è®¡ç®—ä»»åŠ¡ï¼š 2 è®¡ç®—å®Œæˆ</span><br><span class="line">å­çº¿ç¨‹è®¡ç®—ä»»åŠ¡ï¼š 1 è®¡ç®—å®Œæˆ</span><br><span class="line">å­çº¿ç¨‹è®¡ç®—ä»»åŠ¡ï¼š 3 è®¡ç®—å®Œæˆ</span><br><span class="line">å­çº¿ç¨‹è®¡ç®—ä»»åŠ¡ï¼š 4 è®¡ç®—å®Œæˆ</span><br><span class="line">å­çº¿ç¨‹è®¡ç®—ä»»åŠ¡ï¼š 6 è®¡ç®—å®Œæˆ</span><br><span class="line">å­çº¿ç¨‹è®¡ç®—ä»»åŠ¡ï¼š 8 è®¡ç®—å®Œæˆ</span><br><span class="line">å­çº¿ç¨‹è®¡ç®—ä»»åŠ¡ï¼š 7 è®¡ç®—å®Œæˆ</span><br><span class="line">å­çº¿ç¨‹è®¡ç®—ä»»åŠ¡ï¼š 5 è®¡ç®—å®Œæˆ</span><br><span class="line">å­çº¿ç¨‹è®¡ç®—ä»»åŠ¡ï¼š 9 è®¡ç®—å®Œæˆ</span><br><span class="line">å¤šä»»åŠ¡è®¡ç®—åçš„æ€»ç»“æœæ˜¯ï¼š49545</span><br></pre></td></tr></table></figure></p>
<ol>
<li>é«˜å¹¶å‘ç¯å¢ƒä¸‹</li>
</ol>
<p>FutureTaskåœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ç¡®ä¿ä»»åŠ¡åªæ‰§è¡Œä¸€æ¬¡</p>
<p>åœ¨å¾ˆå¤šé«˜å¹¶å‘ç¯å¢ƒä¸‹ï¼Œå¾€å¾€æˆ‘ä»¬åªéœ€è¦æŸäº›ä»»åŠ¡åªæ‰§è¡Œä¸€æ¬¡ã€‚è¿™ç§ä½¿ç”¨åœºæ™¯FutureTaskçš„ç‰¹æ€§æ°å¥½èƒ½èƒœä»»ã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰ä¸€ä¸ªå¸¦keyçš„è¿æ¥æ± ï¼Œå½“keyå­˜åœ¨æ—¶ï¼Œå³ç›´æ¥è¿”å›keyå¯¹åº”çš„å¯¹è±¡ï¼›å½“keyä¸å­˜åœ¨æ—¶ï¼Œåˆ™åˆ›å»ºé“¾æ¥ã€‚å¯¹äºè¿™æ ·çš„åº”ç”¨åœºæ™¯ï¼Œé€šå¸¸é‡‡ç”¨çš„æ–¹æ³•ä¸ºä½¿ç”¨ä¸€ä¸ªMapå¯¹è±¡æ¥å­˜å‚¨keyå’Œè¿æ¥æ± å¯¹åº”çš„å¯¹åº”åˆ®æ´—ï¼Œå…¸å‹çš„ä»£ç å¦‚ä¸‹é¢æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">private Map&lt;String, Connection&gt; connectionPool = new HashMap&lt;String, Connection&gt;();</span><br><span class="line">private ReentrantLock lock = new ReentrantLock();</span><br><span class="line">public Conncetion getConnection(String key) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        if (connectionPool.containsKey(key)) &#123;</span><br><span class="line">            return connectionPool.get(key);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // åˆ›å»ºconnection</span><br><span class="line">            Connection coon = createConnection();</span><br><span class="line">            connectionPool.put(key, coon);</span><br><span class="line">            return coon;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        loco.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// åˆ›å»ºconnection</span><br><span class="line"></span><br><span class="line">private Connection createConnection() &#123;</span><br><span class="line">    return null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æ·é”ç¡®ä¿é«˜å¹¶å‘ç¯å¢ƒä¸‹çš„çº¿ç¨‹å®‰å…¨ï¼Œä¹Ÿç¡®ä¿äº†connection åªåˆ›å»ºä¸€æ¬¡ï¼Œç„¶è€Œç¡®ç‰ºç‰²äº†æ€§èƒ½ã€‚æ”¹ç”¨ConcurrentHashçš„æƒ…å†µä¸‹ï¼Œå‡ ä¹å¯ä»¥é¿å…æ·é”çš„æ“ä½œï¼Œæ€§èƒ½å¤§å¤§æé«˜ï¼Œä½†æ˜¯åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹æœ‰å¯èƒ½å‡ºç°Connectionè¢«åˆ›å»ºå¤šæ¬¡çš„ç°è±¡ã€‚è¿™æ—¶æœ€éœ€è¦è§£å†³çš„é—®é¢˜å°±æ˜¯å½“keyä¸å­˜åœ¨æ—¶ï¼Œåˆ›å»ºConnectionçš„åŠ¨ä½œèƒ½æ”¾åœ¨connectionPoolä¹‹åæ‰§è¡Œï¼Œè¿™æ­£å¼FutureTaskå‘æŒ¥ä½œç”¨çš„æ—¶æœºï¼ŒåŸºäºConcurrentHashMapå’ŒFutureTaskçš„æ”¹é€ ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">private ConcurrentHashMap&lt;String, FutureTask&lt;Connection&gt;&gt; connectionPool = new ConcurrentHashMap&lt;String, FutureTask&lt;Connection&gt;&gt;();</span><br><span class="line"></span><br><span class="line">public Connection getConnection(String key) throws Exception &#123;</span><br><span class="line">    FutureTask&lt;Connection&gt; connectionTask = connectionPool.get(key);</span><br><span class="line">    if (connectionTask != null) &#123;</span><br><span class="line">        return connectionTask.get();</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        Callable&lt;Connection&gt; callable = new Callable&lt;Connection&gt;() &#123;</span><br><span class="line">            @override</span><br><span class="line">            public Connection call() throws Exception &#123;</span><br><span class="line">                return createConnection();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        FutureTask&lt;Connection&gt; newTask = new FutureTask&lt;Connection&gt;(callable);</span><br><span class="line">        connectionTask = connectionPool.put(key, newTask);</span><br><span class="line">        if (connectionTask != null) &#123;</span><br><span class="line">            connectionTask = newTask;</span><br><span class="line">            connectionTask.run();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return connectionTask.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// åˆ›å»ºconnection</span><br><span class="line">private Connection createConnection() &#123;</span><br><span class="line">    return null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»è¿‡è¿™æ ·çš„æ”¹é€ ï¼Œå¯ä»¥é¿å…ç”±äºå¹¶å‘å¸¦æ¥çš„å¤šæ¬¡åˆ›å»ºé“¾æ¥åŠé”çš„å‡ºç°ã€‚</p>
<h3 id="11-ä»€ä¹ˆæ˜¯åŒæ­¥å®¹å™¨å’Œå¹¶å‘å®¹å™¨çš„å®ç°ï¼Ÿ"><a href="#11-ä»€ä¹ˆæ˜¯åŒæ­¥å®¹å™¨å’Œå¹¶å‘å®¹å™¨çš„å®ç°ï¼Ÿ" class="headerlink" title="11. ä»€ä¹ˆæ˜¯åŒæ­¥å®¹å™¨å’Œå¹¶å‘å®¹å™¨çš„å®ç°ï¼Ÿ"></a>11. ä»€ä¹ˆæ˜¯åŒæ­¥å®¹å™¨å’Œå¹¶å‘å®¹å™¨çš„å®ç°ï¼Ÿ</h3><p>ä¸€ã€åŒæ­¥å®¹å™¨</p>
<p>ä¸»è¦ä»£è¡¨æœ‰Vectorå’ŒHashTableï¼Œä»¥åŠCollections.sychronizedXxxç­‰ã€‚é”çš„ç²’åº¦ä¸ºå½“å‰å¯¹è±¡æ•´ä½“ã€‚è¿­ä»£å™¨æ˜¯åŠæ—¶å¤±è´¥çš„ï¼Œå³åœ¨è¿­ä»£è¿‡ç¨‹ä¸­å‘ç°è¢«ä¿®æ”¹ï¼Œå°±ä¼šæŠ›å‡ºConcurrentModificationExceptionã€‚</p>
<p>äºŒã€å¹¶å‘å®¹å™¨</p>
<p>ä¸»è¦æœ‰ConcurrentHashMapã€CopyOnWriteArrayListã€ConcurrentSkipListMapã€ConcurrentSkipListSetã€‚é”çš„ç²’åº¦æ˜¯åˆ†æ•£çš„ã€ç»†ç²’åº¦çš„ï¼Œå³è¯»å’Œå†™ä½¿ç”¨ä¸åŒçš„é”ã€‚è¿­ä»£å™¨å…·æœ‰å¼±ä¸€è‡´æ€§ï¼Œå³å¯ä»¥å®¹å¿å¹¶å‘ä¿®æ”¹ï¼Œä¸ä¼šæŠ›å‡ºConcurrentModificationExceptionã€‚</p>
<p>JDK7 ConcurrentHashMap</p>
<p>é‡‡ç”¨åˆ†ç¦»é”æŠ€æœ¯ï¼ŒåŒæ­¥å®¹å™¨ä¸­ï¼Œæ˜¯ä¸€ä¸ªå®¹å™¨ä¸€ä¸ªé”ï¼Œä½†åœ¨ConcurrentHashMapä¸­ï¼Œä¼šå°†hashè¡¨çš„æ•°ç»„éƒ¨åˆ†åˆ†æˆè‹¥å¹²æ®µï¼Œæ¯æ®µç»´æŠ¤ä¸€ä¸ªé”ï¼Œä»¥è¾¾åˆ°é«˜æ•ˆçš„å¹¶å‘è®¿é—®ï¼›</p>
<p>JDK8 ConcurrentHashMap</p>
<p>é‡‡ç”¨åˆ†ç¦»é”æŠ€æœ¯ï¼ŒåŒæ­¥å®¹å™¨ä¸­ï¼Œæ˜¯ä¸€ä¸ªå®¹å™¨ä¸€ä¸ªé”ï¼Œä½†åœ¨ConcurrentHashMapä¸­ï¼Œä¼šå°†hashè¡¨çš„æ•°ç»„éƒ¨åˆ†åˆ†æˆè‹¥å¹²æ®µï¼Œæ¯æ®µç»´æŠ¤ä¸€ä¸ªé”ï¼Œä»¥è¾¾åˆ°é«˜æ•ˆçš„å¹¶å‘è®¿é—®ï¼›</p>
<p>ä¸‰ã€é˜»å¡é˜Ÿåˆ—</p>
<p>ä¸»è¦æœ‰LinkedBlockingQueueã€ArrayBlockingQueueã€PriorityBlockingQueue(Comparableã€Comparator)ã€SynchronousQueueã€‚æä¾›äº†å¯é˜»å¡çš„putå’Œtakeæ–¹æ³•ï¼Œä»¥åŠæ”¯æŒå®šæ—¶çš„offerå’Œpollæ–¹æ³•ã€‚é€‚ç”¨äºç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ï¼ˆçº¿ç¨‹æ± å’Œå·¥ä½œé˜Ÿåˆ—-Executorï¼‰,åŒæ—¶ä¹Ÿæ˜¯åŒæ­¥å®¹å™¨ã€‚</p>
<p>å››ã€åŒç«¯é˜Ÿåˆ—</p>
<p>ä¸»è¦ä»£è¡¨æœ‰ArrayDequeå’ŒLinkedBlockingDequeã€‚æ„ä¹‰ï¼šæ­£å¦‚é˜»å¡å¯¹å’é€‚ç”¨äºç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ï¼ŒåŒç«¯é˜Ÿåˆ—åŒæ ·é€‚ç”¨äºå¦ä¸€ç§æ¨¡å¼ï¼Œå³å·¥ä½œå¯†å–ã€‚åœ¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…è®¾è®¡ä¸­ï¼Œæ‰€æœ‰æ¶ˆè´¹è€…å…±äº«ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—ï¼Œè€Œåœ¨å·¥ä½œå¯†å–ä¸­ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…éƒ½æœ‰å„è‡ªçš„åŒç«¯é˜Ÿåˆ—ã€‚å¦‚æœä¸€ä¸ªæ¶ˆè´¹è€…å®Œæˆäº†è‡ªå·±çš„åŒç«¯é˜Ÿåˆ—çš„å…¨éƒ¨å·¥ä½œï¼Œé‚£ä¹ˆä»–å°±å¯ä»¥ä»å…¶ä»–æ¶ˆè´¹è€…çš„åŒç«¯é˜Ÿåˆ—æœ«å°¾ç§˜å¯†çš„è·å–å·¥ä½œã€‚å…·æœ‰æ›´å¥½çš„ä¼¸ç¼©æ€§ï¼Œè¿™æ˜¯å› ä¸ºå·¥ä½œè€…çº¿ç¨‹ä¸ä¼šåœ¨å•ä¸ªå…±äº«çš„ä»»åŠ¡é˜Ÿåˆ—ä¸Šå‘ç”Ÿç«äº‰ã€‚åœ¨å¤§å¤šæ•°æ—¶å€™ï¼Œä»–ä»¬éƒ½åªæ˜¯è®¿é—®è‡ªå·±çš„åŒç«¯é˜Ÿåˆ—ï¼Œä»è€Œæå¤§çš„å‡å°‘äº†ç«äº‰ã€‚å½“å·¥ä½œè€…çº¿ç¨‹éœ€è¦è®¿é—®å¦ä¸€ä¸ªé˜Ÿåˆ—æ—¶ï¼Œå®ƒå°±ä»é˜Ÿåˆ—çš„å°¾éƒ¨è€Œä¸æ˜¯å¤´éƒ¨è·å–å·¥ä½œï¼Œå› æ­¤è¿›ä¸€æ­¥é™ä½äº†é˜Ÿåˆ—ä¸Šçš„ç«äº‰ã€‚é€‚ç”¨äºï¼šç½‘é¡µçˆ¬è™«ç­‰ä»»åŠ¡ä¸­ã€‚</p>
<p>äº”ã€æ¯”è¾ƒåŠé€‚ç”¨åœºæ™¯</p>
<p>å¦‚æœä¸éœ€è¦é˜»å¡é˜Ÿåˆ—ï¼Œä¼˜å…ˆé€‰æ‹©ConcurrentLinkedQueueï¼›å¦‚æœéœ€è¦é˜»å¡é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—çš„å¤§å°å›ºå®šä¼˜å…ˆé€‰æ‹©ArrayBlockingQueueï¼Œé˜Ÿåˆ—çš„å¤§å°ä¸å›ºå®šä¼˜å…ˆé€‰æ‹©LinkedBlockingQueueï¼›å¦‚æœéœ€è¦é˜Ÿåˆ—è¿›è¡Œæ’åºï¼Œé€‰æ‹©PriorityBlockingQueueï¼›å¦‚æœéœ€è¦ä¸€ä¸ªå¿«é€Ÿäº¤æ¢çš„é˜Ÿåˆ—ï¼Œé€‰æ‹©SynchronousQueue; å¦‚æœéœ€è¦å¯¹é˜Ÿåˆ—ä¸­çš„å…ƒç´ è¿›è¡Œå»¶æ—¶æ“ä½œï¼Œåˆ™é€‰æ‹©DelayQueueã€‚</p>
<h3 id="12-ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹ï¼Ÿä¼˜ç¼ºç‚¹ï¼Ÿ"><a href="#12-ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹ï¼Ÿä¼˜ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="12. ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹ï¼Ÿä¼˜ç¼ºç‚¹ï¼Ÿ"></a>12. ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹ï¼Ÿä¼˜ç¼ºç‚¹ï¼Ÿ</h3><p>ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹ï¼Ÿ</p>
<p>å¤šçº¿ç¨‹ï¼šæ˜¯æŒ‡ä»è½¯ä»¶æˆ–è€…ç¡¬ä»¶ä¸Šå®ç°å¤šä¸ªçº¿ç¨‹çš„å¹¶å‘æŠ€æœ¯ã€‚</p>
<p>å¤šçº¿ç¨‹çš„å¥½å¤„ï¼š</p>
<ol>
<li>ä½¿ç”¨å¤šçº¿ç¨‹å¯ä»¥æŠŠç¨‹åºä¸­å æ®æ—¶é—´é•¿çš„ä»»åŠ¡æ”¾åˆ°åå°å»å¤„ç†ï¼Œå¦‚å›¾ç‰‡ã€è§†é¢‘çš„ä¸‹è½½</li>
<li>å‘æŒ¥å¤šæ ¸å¤„ç†å™¨çš„ä¼˜åŠ¿ï¼Œå¹¶å‘æ‰§è¡Œè®©ç³»ç»Ÿè¿è¡Œçš„æ›´å¿«ã€æ›´æµç•…ï¼Œç”¨æˆ·ä½“éªŒæ›´å¥½</li>
</ol>
<p>å¤šçº¿ç¨‹çš„ç¼ºç‚¹ï¼š</p>
<ol>
<li>å¤§é‡çš„çº¿ç¨‹é™ä½ä»£ç çš„å¯è¯»æ€§</li>
<li>æ›´å¤šçš„çº¿ç¨‹éœ€è¦æ›´å¤šçš„å†…å­˜ç©ºé—´</li>
<li>å½“å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªèµ„æºå‡ºç°äº‰å¤ºæ—¶å€™è¦æ³¨æ„çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚</li>
</ol>
<h3 id="13-ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ"><a href="#13-ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ" class="headerlink" title="13. ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ"></a>13. ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ</h3><p>å³ä½¿æ˜¯å•æ ¸CPUä¹Ÿæ”¯æŒå¤šçº¿ç¨‹æ‰§è¡Œä»£ç ï¼ŒCPUé€šè¿‡ç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…CPUæ—¶é—´ç‰‡æ¥å®ç°è¿™ä¸ªæœºåˆ¶ã€‚æ—¶é—´ç‰‡æ˜¯CPUåˆ†é…ç»™å„ä¸ªçº¿ç¨‹çš„æ—¶é—´ã€‚å› ä¸ºæ—¶é—´ç‰‡éå¸¸çŸ­ï¼Œæ‰€ä»¥CPUé€šè¿‡ä¸åœçš„åˆ‡æ¢çº¿ç¨‹æ‰§è¡Œï¼Œè®©æˆ‘ä»¬æ„Ÿè§‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæ—¶é—´ç‰‡ä¸€èˆ¬æ˜¯å‡ åæ¯«ç§’</p>
<p>ä¸Šä¸‹æ–‡åˆ‡æ¢è¿‡ç¨‹ä¸­ï¼ŒCPUä¼šåœæ­¢å¤„ç†å½“å‰è¿è¡Œçš„ç¨‹åºï¼Œå¹¶ä¿å­˜å½“å‰ç¨‹åºè¿è¡Œçš„å…·ä½“ä¸ºæ­¢ä»¥ä¾¿ä¹‹åç»§ç»­è¿è¡Œã€‚</p>
<p>CPUé€šè¿‡æ—¶é—´ç‰‡åˆ†é…ç®—æ³•æ¥å¾ªç¯æ‰§è¡Œä»»åŠ¡ï¼Œå½“å‰ä»»åŠ¡æ‰§è¡Œä¸€ä¸ªæ—¶é—´ç‰‡åä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚ä½†æ˜¯ï¼Œåœ¨åˆ‡æ¢å‰ä¼šä¿å­˜ä¸Šä¸€ä¸ªä»»åŠ¡çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä¸‹æ¬¡åˆ‡æ¢å›è¿™ä¸ªä»»åŠ¡æ—¶ï¼Œå¯ä»¥å†æ¬¡åŠ è½½è¿™ä¸ªä»»åŠ¡çš„çŠ¶æ€ã€‚</p>
<ul>
<li>ä»ä»»åŠ¡ä¿å­˜åˆ°å†åŠ è½½çš„è¿‡ç¨‹å°±æ˜¯ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢</li>
</ul>
<h3 id="14-ThreadLocalçš„è®¾è®¡ç†å¿µå’Œä½œç”¨ï¼Ÿ"><a href="#14-ThreadLocalçš„è®¾è®¡ç†å¿µå’Œä½œç”¨ï¼Ÿ" class="headerlink" title="14. ThreadLocalçš„è®¾è®¡ç†å¿µå’Œä½œç”¨ï¼Ÿ"></a>14. ThreadLocalçš„è®¾è®¡ç†å¿µå’Œä½œç”¨ï¼Ÿ</h3><p>Javaä¸­çš„ThreadLocalç±»å…è®¸æˆ‘ä»¬åˆ›å»ºåªèƒ½è¢«åŒä¸€ä¸ªçº¿ç¨‹è¯»å†™çš„å˜é‡ã€‚å› æ­¤ï¼Œå¦‚æœä¸€æ®µä»£ç å«æœ‰ä¸€ä¸ªThreadLocalå˜é‡çš„å¼•ç”¨ï¼Œå³ä½¿ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œè¿™æ®µä»£ç ï¼Œå®ƒä»¬ä¹Ÿæ— æ³•è®¿é—®åˆ°å¯¹æ–¹çš„ThreadLocalå˜é‡</p>
<p>ThreadLocal</p>
<p>å¦‚ä½•åˆ›å»ºThreadLocalå˜é‡ï¼š</p>
<pre><code>private ThreadLocal myTHreadLocal = new ThreadLocal();
</code></pre><p>é€šè¿‡è¿™æ®µä»£ç å®ä¾‹åŒ–äº†ä¸€ä¸ªThreadLocalå¯¹è±¡ã€‚æˆ‘ä»¬åªéœ€è¦å®ä¾‹åŒ–å¯¹è±¡ä¸€æ¬¡ï¼Œå¹¶ä¸”ä¹Ÿä¸éœ€è¦çŸ¥é“å®ƒè¢«å“ªä¸ªçº¿ç¨‹å®ä¾‹åŒ–ã€‚è™½ç„¶æ‰€æœ‰çš„çº¿ç¨‹éƒ½èƒ½è®¿é—®åˆ°è¿™ä¸ªThreadLocalå®ä¾‹ï¼Œä½†æ˜¯æ¯ä¸ªçº¿ç¨‹å´åªèƒ½è®¿é—®åˆ°è‡ªå·±é€šè¿‡è°ƒç”¨ThreadLocalçš„set()æ–¹æ³•è®¾ç½®çš„å€¼ã€‚å³ä½¿æ˜¯ä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹åœ¨åŒä¸€ä¸ªThreadLocalå¯¹è±¡ä¸Šè®¾ç½®äº†ä¸åŒçš„å€¼ï¼Œå®ƒä»¬ä»ç„¶æ— æ³•è®¿é—®åˆ°å¯¹æ–¹çš„å€¼ã€‚</p>
<p>å¦‚ä½•è®¿é—®ThreadLocalå˜é‡</p>
<p>ä¸€æ—¦åˆ›å»ºäº†ä¸€ä¸ªThreadLocalå˜é‡ï¼Œä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç è®¾ç½®æŸä¸ªéœ€è¦ä¿å­˜çš„å€¼ï¼š</p>
<pre><code>myTHreadLocal.set(&quot; A thread local value&quot;);
</code></pre><p>å¯ä»¥é€šè¿‡ä¸‹é¢æ–¹æ³•è¯»å–ä¿å­˜åœ¨ThreadLocalå˜é‡ä¸­çš„å€¼ï¼š</p>
<pre><code>String threadLocalValue = (String) myThreadLocal.get();
</code></pre><p>get()æ–¹æ³•è¿”å›ä¸€ä¸ªObjectå¯¹è±¡ï¼Œset()å¯¹è±¡éœ€è¦ä¼ å…¥ä¸€ä¸ªObjectç±»å‹çš„å‚æ•°ã€‚</p>
<p>ä¸ºThreadLocalæŒ‡å®šæ³›å‹ç±»å‹</p>
<pre><code>public static ThreadLocal&lt;String&gt; myThreadLocal = new ThreadLocal&lt;String&gt;();
</code></pre><p> æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ‰§è¡Œæ³›å‹çš„ThreadLocalå¯¹è±¡ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦æ¯æ¬¡å¯¹ä½¿ç”¨get()æ–¹æ³•è¿”å›çš„å€¼ä½œå¼ºåˆ¶ç±»å‹è½¬æ¢äº†ã€‚</p>
<p> ThreadLocalçš„ä»‹ç»</p>
<p> ThreadLocalæ˜¯ä¸€ä¸ªçº¿ç¨‹çš„å†…éƒ¨å­˜å‚¨ç±»ï¼Œå¯ä»¥åœ¨æ¯ä¸ªçº¿ç¨‹çš„å†…éƒ¨å­˜å‚¨æ•°æ®ï¼Œå½“æŸä¸ªæ•°æ®çš„ä½œç”¨åŸŸåº”è¯¥å¯¹åº”çº¿ç¨‹çš„æ—¶å€™å°±åº”è¯¥ä½¿ç”¨å®ƒï¼›</p>
<p> è€Œæ˜¯å½“æŸä¸ªå¾ˆå¤æ‚çš„é€»è¾‘ä¸‹çš„å¯¹è±¡ä¼ é€’ï¼Œéœ€è¦åœ¨çº¿ç¨‹è¿™ä¸ªä½œç”¨åŸŸå†…è´¯ç©¿å…¶ä¸­ï¼Œç”¨ThreadLocalå¯ä»¥é¿å…è¿™ä¸ªåˆ›å»ºå¤šä¸ªé™æ€ç±»ã€‚</p>
<p> å½“ä½ åˆ›å»ºä¸€ä¸ªThreadLocalå¯¹è±¡åï¼Œæ³¨æ„ï¼Œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä½ åœ¨ä¸åŒçº¿ç¨‹ä¸­å»è®¿é—®å®ƒçš„å€¼æ˜¯å¯ä»¥ä¸ä¸€æ ·æ»´ï¼Œå¹¶ä¸”æ˜¯å’Œçº¿ç¨‹ç›¸å…³è”çš„ã€‚</p>
<p> å®ƒçš„å®ç°åŸç†å…¶å®æ¯”è¾ƒç®€å•ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸­éƒ½ä¼šç»´æŠ¤ä¸€ä¸ªThreadLocalMapï¼Œå½“åœ¨æŸä¸ªçº¿ç¨‹ä¸­è®¿é—®æ—¶ï¼Œä¼šå–å‡ºè¿™ä¸ªçº¿ç¨‹è‡ªå·±çš„Mapå¹¶ä¸”ç”¨å½“å‰ThreadLocalå¯¹è±¡ä½œç´¢å¼•æ¥å–å‡ºç›¸å¯¹åº”çš„valueå€¼ï¼Œä»è€Œè¾¾åˆ°ä¸åŒçº¿ç¨‹ä¸åŒå€¼çš„æ•ˆæœã€‚</p>
<p> å®ç°åŸç†</p>
<ol>
<li><p>æ¯ä¸ªThreadå¯¹è±¡å†…éƒ¨éƒ½ç»´æŠ¤æ¥ä¸€ä¸ªThreadLocalMapè¿™æ ·ä¸€ä¸ªThreadLocalçš„Mapï¼Œå¯ä»¥å­˜æ”¾è‹¥å¹²ä¸ªThreadLocalã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ThreadLocal.ThreadLocalMap threadLocals = null;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å½“æˆ‘ä»¬åœ¨è°ƒç”¨get()æ–¹æ³•çš„æ—¶å€™ï¼Œå…ˆè·å–å½“å‰çº¿ç¨‹ï¼Œç„¶åè·å–åˆ°å½“å‰çº¿ç¨‹çš„ThreadLocalMapå¯¹è±¡ï¼Œå¦‚æœéç©ºï¼Œé‚£ä¹ˆå–å‡ºThreadLocalçš„value,å¦åˆ™è¿›è¡Œåˆå§‹åŒ–ï¼Œåˆå§‹åŒ–å°±æ˜¯å°†initialValueçš„å€¼setåˆ°ThreadLocalä¸­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public T get() &#123;</span><br><span class="line">    Thread t = Thread.currentThread();</span><br><span class="line">    ThreadLocalMap map = getMap(t);</span><br><span class="line">    if (map != null) &#123;</span><br><span class="line">        THreadLocalMap.Entry e = map.getEntry(this);</span><br><span class="line">        if (e != null) &#123;</span><br><span class="line">            return (T) e.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return setInitialValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å½“æˆ‘ä»¬è°ƒç”¨set()æ–¹æ³•çš„æ—¶å€™ï¼Œå¾ˆå¸¸è§„ï¼Œå°±æ˜¯å°†å€¼è®¾ç½®è¿›ThreadLocalä¸­ã€‚</p>
</li>
<li><p>ThreadLocalMapé‡Œé¢å­˜å‚¨çš„Entryå¯¹è±¡æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªWeakReference<threadlocal>ã€‚</threadlocal></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒThreadLocalMapé‡Œé¢å­˜å‚¨çš„å¯¹è±¡æœ¬è´¨æ˜¯ä¸€ä¸ªå¯¹ThreadLocalå¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œè¯¥ThreadLocaléšæ—¶å¯èƒ½ä¼šè¢«å›æ”¶ã€‚</p>
<p>å³å¯¼è‡´ThreadLocalMapé‡Œé¢å¯¹åº”çš„valueçš„keyæ˜¯nullã€‚æˆ‘ä»¬éœ€è¦æŠŠè¿™æ ·çš„Entryç»™æ¸…é™¤æ‰ï¼Œä¸è¦è®©ä»–ä»¬å å‘ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</p>
<p>é‚£ä¸ºä»€ä¹ˆéœ€è¦å¼±å¼•ç”¨å‘¢ï¼Ÿ</p>
<p>å› ä¸ºçº¿ç¨‹çš„å£°æ˜å‘¨æœŸæ˜¯é•¿äºThreadLocalå¯¹è±¡çš„ï¼Œå½“æ­¤å¯¹è±¡ä¸å†éœ€è¦çš„æ—¶å€™å¦‚æœçº¿ç¨‹ä¸­è¿˜æŒæœ‰å®ƒçš„å¼•ç”¨åŠ¿å¿…ä¹Ÿä¼šäº§ç”Ÿå†…å­˜æ³„æ¼çš„é—®é¢˜ï¼Œæ‰€ä»¥è‡ªç„¶åº”è¯¥æ˜¯ç”¨å¼±å¼•ç”¨æ¥è¿›è¡Œkeyçš„ä¿æŠ¤ã€‚</p>
</li>
</ol>
<h3 id="15-ThreadPool-çº¿ç¨‹æ± -ç”¨æ³•ä¸ä¼˜åŠ¿ï¼Ÿ"><a href="#15-ThreadPool-çº¿ç¨‹æ± -ç”¨æ³•ä¸ä¼˜åŠ¿ï¼Ÿ" class="headerlink" title="15. ThreadPool(çº¿ç¨‹æ± )ç”¨æ³•ä¸ä¼˜åŠ¿ï¼Ÿ"></a>15. ThreadPool(çº¿ç¨‹æ± )ç”¨æ³•ä¸ä¼˜åŠ¿ï¼Ÿ</h3><p> ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± ï¼š</p>
<ol>
<li><p>å‡å°‘åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„æ¬¡æ•°ï¼Œæ¯ä¸ªå·¥ä½œçº¿ç¨‹å¯ä»¥è¢«é‡å¤åˆ©ç”¨ï¼Œå¯æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚</p>
</li>
<li><p>å¯ä»¥æ ¹æ®ç³»ç»Ÿçš„æ‰¿å—èƒ½åŠ›ï¼Œè°ƒæ•´çº¿ç¨‹æ± ä¸­å·¥ä½œçº¿ç¨‹çº¿ç¨‹æ•°ç›®ï¼Œé˜²æ­¢å› ä¸ºæ¶ˆè€—è¿‡å¤šçš„å†…å­˜ï¼Œè€ŒæŠŠæœåŠ¡ææ­»æœº</p>
</li>
<li><p>Javaé‡Œé¢çº¿ç¨‹æ± çš„é¡¶çº§æ¥å£æ˜¯Executorï¼Œä½†æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šè®²Executorå¹¶ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œè€Œåªæ˜¯ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹çš„å·¥å…·ã€‚çœŸæ­£çš„çº¿ç¨‹æ± æ¥å£æ˜¯ExecutorServiceã€‚</p>
<p>new Thread ç¼ºç‚¹</p>
</li>
<li><p>æ¯æ¬¡new Threadæ–°å»ºå¯¹è±¡æ€§èƒ½å·®</p>
</li>
<li><p>çº¿ç¨‹ç¼ºä¹ç»Ÿä¸€ç®¡ç†ï¼Œå¯èƒ½æ— é™åˆ¶æ–°å»ºçº¿ç¨‹ï¼Œç›¸äº’ä¹‹é—´ç«äº‰ï¼ŒåŠå¯èƒ½å ç”¨è¿‡å¤šç³»ç»Ÿèµ„æºå¯¼è‡´æ­»æœºæˆ–OOM</p>
</li>
<li><p>ç¼ºä¹æ›´å¤šåŠŸèƒ½ï¼Œå¦‚å®šæ—¶æ‰§è¡Œï¼Œå®šæœŸæ‰§è¡Œï¼Œçº¿ç¨‹ä¸­æ–­</p>
<p>ThreadPoolä¼˜ç‚¹</p>
<p>å‡å°‘åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„æ¬¡æ•°ï¼Œæ¯ä¸ªå·¥ä½œçº¿ç¨‹éƒ½å¯ä»¥è¢«é‡å¤åˆ©ç”¨ï¼Œå¯æ‰§è¡Œå¤šä¸ªä»»åŠ¡</p>
<p>å¯ä»¥æ ¹æ®ç³»ç»Ÿçš„æ‰¿å—èƒ½åŠ›ï¼Œè°ƒæ•´çº¿ç¨‹æ± ä¸­å·¥ä½œçº¿ç¨‹çš„æ•°ç›®ï¼Œé˜²æ­¢å› ä¸ºæ¶ˆè€—è¿‡å¤šçš„å†…å­˜ï¼Œè€Œè®©æœåŠ¡å™¨æ­»æœº</p>
</li>
</ol>
<ul>
<li>å‡å°‘åœ¨åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ä¸Šæ‰€ç”»çš„æ—¶é—´ä»¥åŠç³»ç»Ÿèµ„æºçš„å¼€é”€</li>
<li><p>å¦‚ä¸ä½¿ç”¨çº¿ç¨‹æ± ï¼Œæœ‰å¯èƒ½é€ æˆç³»ç»Ÿåˆ›å»ºå¤§é‡çº¿ç¨‹è€Œå¯¼è‡´æ¶ˆè€—å®Œç³»ç»Ÿå†…å­˜</p>
<p>Javaæä¾›çš„å››ç§çº¿ç¨‹æ± çš„å¥½å¤„åœ¨äºï¼š</p>
</li>
</ul>
<ol>
<li>é‡ç”¨å­˜åœ¨çš„çº¿ç¨‹ï¼Œå‡å°‘å¯¹è±¡åˆ›å»ºã€é”€æ¯çš„å¼€é”€ï¼Œæé«˜æ€§èƒ½ã€‚</li>
<li>å¯æœ‰æ•ˆæ§åˆ¶æœ€å¤§å¹¶å‘çº¿ç¨‹æ•°ï¼Œæé«˜ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨ç‡ï¼ŒåŒæ—¶é¿å…è¿‡å¤šèµ„æºç«äº‰ï¼Œé¿å…é˜»å¡ã€‚</li>
<li><p>æä¾›å®šæ—¶æ‰§è¡Œï¼Œå®šæœŸæ‰§è¡Œï¼Œå•çº¿ç¨‹ï¼Œå¹¶å‘ä¹¦æ§åˆ¶ç­‰åŠŸèƒ½ã€‚</p>
<p>æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªç±»ï¼š</p>
<p>| ç±» | æè¿° |<br>| :â€” | :â€”-: |<br>| ExecutorService | çœŸæ­£çš„çº¿ç¨‹æ± æ¥å£ã€‚ |<br>| ScheduledExecutorService    | èƒ½å’ŒTimer/TimerTaskç±»ä¼¼ï¼Œè§£å†³å“ªäº›éœ€è¦ä»»åŠ¡é‡å¤æ‰§è¡Œçš„é—®é¢˜      |<br>| ThreadPoolExecutor   | ExecutorServiceçš„é»˜è®¤å®ç°  |<br>| ScheduledThreadPoolExecutor  | ç»§æ‰¿ThreadPoolExecutorçš„ScheduledExecutorServiceæ¥å£å®ç°ï¼Œå‘¨æœŸæ€§ä»»åŠ¡è°ƒåº¦çš„ç±»å®ç°|ã€‚</p>
<p>è¦é…ç½®ä¸€ä¸ªçº¿ç¨‹æ± æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå°¤å…¶æ˜¯å¯¹çº¿ç¨‹æ± çš„åŸç†ä¸æ˜¯å¾ˆæ¸…æ¥šçš„æƒ…å†µä¸‹ï¼Œå¾ˆæœ‰å¯èƒ½é…ç½®çš„çº¿ç¨‹æ± ä¸æ˜¯è¾ƒä¼˜çš„ï¼Œå› æ­¤åœ¨Executorsç±»é‡Œé¢æä¾›ç±»ä¸€äº›é™æ€å·¥å‚ï¼Œç”Ÿæˆä¸€äº›å¸¸ç”¨çš„çº¿ç¨‹æ± ã€‚</p>
<p>Executorsæä¾›å››ç§çº¿ç¨‹æ± </p>
<p>newCachedThreadPoolåˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çº¿ç¨‹æ± ï¼Œå¦‚æœçº¿ç¨‹æ± é•¿åº¦è¶…è¿‡å¤„ç†éœ€è¦ï¼Œå¯å›æ”¶ç©ºé—²çº¿ç¨‹ï¼Œè‹¥æ— å¯å›æ”¶ï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹ã€‚</p>
<p>newFixedThreadPoolåˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œå¯æ§åˆ¶çº¿ç¨‹æœ€å¤§å¹¶å‘æ•°ï¼Œè¶…å‡ºçš„çº¿ç¨‹ä¼šåœ¨é˜Ÿåˆ—æ€»ç­‰å¾…ã€‚</p>
<p>newScheduledThreadPoolåˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œæ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œã€‚</p>
<p>newScheduledThreadPoolåˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± ï¼Œå®ƒåªä¼šç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥ä¿è¯æ‰§è¡Œä»»åŠ¡ï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåºï¼ˆFIFOï¼ŒLIFOï¼Œä¼˜å…ˆçº§ï¼‰æ‰§è¡Œã€‚</p>
<p>ä¸€èˆ¬éƒ½ä¸ç”¨Executorsæä¾›çš„çº¿ç¨‹åˆ›å»ºæ–¹å¼</p>
<p>ä½¿ç”¨ThreadPoolExecutoråˆ›å»ºçº¿ç¨‹æ± </p>
<p>ThreadPoolExecutorçš„æ„é€ å‡½æ•°</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public ThreadPoolExecutor(int corePoolSize,</span><br><span class="line">                              int maximumPoolSize,</span><br><span class="line">                              long keepAliveTime,</span><br><span class="line">                              TimeUnit unit,</span><br><span class="line">                              BlockingQueue&lt;Runnable&gt; workQueue,</span><br><span class="line">                              ThreadFactory threadFactory,</span><br><span class="line">                              RejectedExecutionHandler handler) &#123;</span><br><span class="line">        if (corePoolSize &lt; 0 ||</span><br><span class="line">            maximumPoolSize &lt;= 0 ||</span><br><span class="line">            maximumPoolSize &lt; corePoolSize ||</span><br><span class="line">            keepAliveTime &lt; 0)</span><br><span class="line">            throw new IllegalArgumentException();</span><br><span class="line">        if (workQueue == null || threadFactory == null || handler == null)</span><br><span class="line">            throw new NullPointerException();</span><br><span class="line">        this.corePoolSize = corePoolSize;</span><br><span class="line">        this.maximumPoolSize = maximumPoolSize;</span><br><span class="line">        this.workQueue = workQueue;</span><br><span class="line">        this.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">        this.threadFactory = threadFactory;</span><br><span class="line">        this.handler = handler;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å‚æ•°ï¼š</p>
<ol>
<li><p>corePoolSizeæ ¸å¿ƒçº¿ç¨‹æ•°å¤§å°ï¼Œå½“çº¿ç¨‹æ•° &lt; corePoolSizeï¼Œä¼šåˆ›å»ºçº¿ç¨‹æ‰§è¡Œrunnable</p>
</li>
<li><p>maximumPoolSizeæœ€å¤§çº¿ç¨‹æ•°ï¼Œå½“çº¿ç¨‹æ•° &gt;= corePoolSizeçš„æ—¶å€™ï¼Œä¼šæŠŠrunnableæˆ¿å±‹workQueueä¸­</p>
</li>
<li><p>keepAliveTimeä¿æŒå­˜æ´»æ—¶é—´ï¼Œå½“çº¿ç¨‹æ•° &gt; corePoolSizeçš„ç©ºé—²çº¿ç¨‹èƒ½ä¿æŒçš„æœ€å¤§æ—¶é—´ã€‚</p>
</li>
<li><p>unit æ—¶é—´å•ä½</p>
</li>
<li><p>workQueueä¿å­˜ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—</p>
</li>
<li><p>threadFactory åˆ›å»ºçº¿ç¨‹çš„å·¥å‚</p>
</li>
<li><p>handler æ‹’ç»ç­–ç•¥</p>
</li>
</ol>
<p>ä»»åŠ¡æ‰§è¡Œé¡ºåºï¼š</p>
<ol>
<li><p>å½“çº¿ç¨‹æ•°å°äº corePoolSizeï¼Œåˆ›å»ºçº¿ç¨‹æ‰§è¡Œä»»åŠ¡</p>
</li>
<li><p>å½“çº¿ç¨‹æ•°å¤§äºç­‰äº corePoolSize å¹¶ä¸”workQueueæ²¡æœ‰æ»¡æ—¶ï¼Œæ”¾å…¥workQueueä¸­</p>
</li>
<li><p>å½“çº¿ç¨‹æ•°å¤§äºç­‰äº corePoolSizeå¹¶ä¸”å½“workQueueæ»¡æ—¶ï¼Œæ–°ä»»åŠ¡æ–°å»ºçº¿ç¨‹è¿è¡Œï¼Œçº¿ç¨‹æ€»æ•°è¦å°äºmaximumPoolSize</p>
</li>
<li><p>å½“çº¿ç¨‹æ€»æ•°ç­‰äºmaximumPoolSizeå¹¶ä¸”workQueueæ»¡äº†çš„æ—¶å€™æ‰§è¡Œhandlerçš„rejectedExecutorã€‚ä¹Ÿå°±æ˜¯æ‹’ç»ç­–ç•¥</p>
</li>
</ol>
<p>ThreadPoolExecutoré»˜è®¤æœ‰å››ä¸ªæ‹’ç»ç­–ç•¥ï¼š</p>
<ol>
<li><p>ThreadPoolExecutor.AbortPolicy() ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼ŒRejectedExecutionException</p>
</li>
<li><p>ThreadPoolExecutor.CallerRunsPolicy()ç›´æ¥è°ƒç”¨runæ–¹æ³•å¹¶é˜»å¡æ‰§è¡Œ</p>
</li>
<li><p>ThreadPoolExecutor.DiscardPolicy()ç›´æ¥ä¸¢å¼ƒåæ¥çš„ä»»åŠ¡</p>
</li>
<li><p>ThreadPoolExecutor.DiscardOldestPolicy() ä¸¢å¼ƒåœ¨é˜Ÿåˆ—ä¸­é˜Ÿé¦–çš„ä»»åŠ¡</p>
</li>
</ol>
<p>å½“ç„¶å¯ä»¥è‡ªå·±ç»§æ‰¿RejectedExecutionHandleræ¥å†™æ‹’ç»ç­–ç•¥</p>
<p>å‚è€ƒæ¥æºï¼š<a href="https://juejin.im/post/5aae4e8f6fb9a028e52d9e8c" target="_blank" rel="noopener">https://juejin.im/post/5aae4e8f6fb9a028e52d9e8c</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.choleece.cn/2018/06/03/reflection/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="choleece">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="choleece">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/03/reflection/" itemprop="url">Java åå°„</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-06-03T10:13:57+08:00">
                2018-06-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Javaåå°„æµ…æ"><a href="#Javaåå°„æµ…æ" class="headerlink" title="Javaåå°„æµ…æ"></a>Javaåå°„æµ…æ</h3><pre><code>Javaåå°„æœºåˆ¶æ˜¯åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹ä»»æ„ä¸€ä¸ªç±»éƒ½èƒ½çŸ¥é“è¿™ä¸ªç±»çš„å±æ€§å’Œæ–¹æ³•ï¼›
å¯¹ä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½è°ƒç”¨å®ƒçš„ä»»æ„å±æ€§å’Œæ–¹æ³•ï¼›
</code></pre><h4 id="åå°„æœºåˆ¶è·å–ç±»çš„ä¸‰ç§æ–¹æ³•"><a href="#åå°„æœºåˆ¶è·å–ç±»çš„ä¸‰ç§æ–¹æ³•" class="headerlink" title="åå°„æœºåˆ¶è·å–ç±»çš„ä¸‰ç§æ–¹æ³•"></a>åå°„æœºåˆ¶è·å–ç±»çš„ä¸‰ç§æ–¹æ³•</h4><ol>
<li><p>é€šè¿‡ç±»å + .classç›´æ¥è·å¾—</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class clazz = Student.class;</span><br></pre></td></tr></table></figure>
</li>
<li><p>é€šè¿‡å¯¹è±¡è°ƒç”¨getClass()ç›´æ¥è·å¾—</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Object obj = new Student();</span><br><span class="line">obj.getClass();</span><br></pre></td></tr></table></figure>
</li>
<li><p>é€šè¿‡å…¨ç±»åè·å–ï¼Œç”¨å¾—æ¯”è¾ƒå¤šï¼Œä½†å¯èƒ½æŠ›å‡ºClassNotFoundException</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class clazz = Class.forName(&quot;com.choleece.Student&quot;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="åˆ©ç”¨newInstanceåˆ›å»ºå¯¹è±¡ï¼Œè°ƒç”¨çš„ç±»å¿…é¡»è¦æœ‰æ— å‚çš„æ„é€ å‡½æ•°"><a href="#åˆ©ç”¨newInstanceåˆ›å»ºå¯¹è±¡ï¼Œè°ƒç”¨çš„ç±»å¿…é¡»è¦æœ‰æ— å‚çš„æ„é€ å‡½æ•°" class="headerlink" title="åˆ©ç”¨newInstanceåˆ›å»ºå¯¹è±¡ï¼Œè°ƒç”¨çš„ç±»å¿…é¡»è¦æœ‰æ— å‚çš„æ„é€ å‡½æ•°"></a>åˆ©ç”¨newInstanceåˆ›å»ºå¯¹è±¡ï¼Œè°ƒç”¨çš„ç±»å¿…é¡»è¦æœ‰æ— å‚çš„æ„é€ å‡½æ•°</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Class clazz = Class.forName(&quot;com.choleece.Student&quot;);</span><br><span class="line">// æ‰€ä»¥æˆ‘ä»¬åœ¨å†™ç±»çš„æ—¶å€™ï¼Œå¿…é¡»å†™ä¸€ä¸ªæ— å‚çš„æ„é€ å‡½æ•°ï¼Œå°±æ˜¯ç»™åå°„ç”¨çš„</span><br><span class="line">Object obj = clazz.newInstance();</span><br></pre></td></tr></table></figure>
<h4 id="æ„é€ å™¨"><a href="#æ„é€ å™¨" class="headerlink" title="æ„é€ å™¨"></a>æ„é€ å™¨</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// è·å–ç±»å…¨éƒ¨çš„æ„é€ æ–¹æ³•</span><br><span class="line">Constructor&lt;Student&gt;[] constructors = (Constructor&lt;Student&gt;[]) Class.forName(&quot;com.choleece.Student&quot;).getConstructors();</span><br><span class="line"></span><br><span class="line">// è·å–ç±»åˆ¶å®šçš„æ„é€ æ–¹æ³•</span><br><span class="line">Constructor&lt;Student&gt; constructor = (Constructor&lt;Student&gt;) Class.forName(&quot;com.choleece.Student&quot;).getCOnstructor(String.class, Integer.class);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.choleece.cn/2018/05/31/java-reference/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="choleece">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="choleece">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/31/java-reference/" itemprop="url">java-reference</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-05-31T07:32:07+08:00">
                2018-05-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Java-å¼ºå¼•ç”¨ã€å¼±å¼•ç”¨ã€è½¯å¼•ç”¨ã€è™šå¼•ç”¨çš„åŒºåˆ«"><a href="#Java-å¼ºå¼•ç”¨ã€å¼±å¼•ç”¨ã€è½¯å¼•ç”¨ã€è™šå¼•ç”¨çš„åŒºåˆ«" class="headerlink" title="Java å¼ºå¼•ç”¨ã€å¼±å¼•ç”¨ã€è½¯å¼•ç”¨ã€è™šå¼•ç”¨çš„åŒºåˆ«"></a>Java å¼ºå¼•ç”¨ã€å¼±å¼•ç”¨ã€è½¯å¼•ç”¨ã€è™šå¼•ç”¨çš„åŒºåˆ«</h3><h4 id="Java-ä¸­æœ‰å¦‚ä¸‹å››ç§å¼•ç”¨ç±»å‹"><a href="#Java-ä¸­æœ‰å¦‚ä¸‹å››ç§å¼•ç”¨ç±»å‹" class="headerlink" title="Java ä¸­æœ‰å¦‚ä¸‹å››ç§å¼•ç”¨ç±»å‹"></a>Java ä¸­æœ‰å¦‚ä¸‹å››ç§å¼•ç”¨ç±»å‹</h4><ol>
<li>å¼ºå¼•ç”¨ StrongReference</li>
<li>å¼±å¼•ç”¨ WeekReference</li>
<li>è½¯å¼•ç”¨ SoftReference</li>
<li>è™šå¼•ç”¨ PhantomReference</li>
</ol>
<p>å¼ºå¼•ç”¨æ˜¯æˆ‘ä»¬åœ¨ç¼–ç¨‹è¿‡ç¨‹ä¸­æœ€ç®€å•çš„å¼•ç”¨ï¼Œå¦‚String s = â€œabcâ€ä¸­å˜é‡så°±æ˜¯å¯¹å­—ç¬¦ä¸²â€abcâ€çš„å¼ºå¼•ç”¨ï¼Œä»»ä½•è¢«å¼ºå¼•ç”¨æŒ‡å‘çš„å¯¹è±¡éƒ½ä¸èƒ½è¢«GCå›æ”¶ï¼Œè¿™äº›å¯¹è±¡éƒ½æ˜¯åœ¨ç¨‹åºä¸­éœ€è¦çš„ã€‚å¼±å¼•ç”¨ä½¿ç”¨java.lang.ref.WeakReference classè¡¨ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç åˆ›å»ºå¼±å¼•ç”¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Counter counter = new Counter(); // strong reference</span><br><span class="line">WeakReference&lt;Counter&gt; wf = new WeakReference&lt;Counter&gt;(counter); // weak</span><br><span class="line">counter = null; // ç°åœ¨counter æ˜¯å¯ä»¥è¢«GCå›æ”¶çš„</span><br></pre></td></tr></table></figure>
<p>åœ¨ç»™å¯¹è±¡èµ‹å€¼nullåï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«GCå›æ”¶ã€‚è¯¥å¯¹è±¡ä¸å†æœ‰å¼ºå¼•ç”¨ï¼Œå³ä½¿è¯¥å¯¹è±¡æœ‰è‹¥å¼•ç”¨ï¼Œä¹Ÿä¼šè¢«GCç«‹å³å›æ”¶ï¼Œç›¸åï¼Œå¦‚æœè¯¥å¯¹è±¡æœ‰è½¯å¼•ç”¨ï¼Œcounterä¸ä¼šè¢«ç«‹å³å›æ”¶ï¼Œé™¤éJVMéœ€è¦å†…å­˜ï¼ŒJavaä¸­çš„è½¯å¼•ç”¨ä½¿ç”¨java.lang.ref.SoftReferenceç±»æ¥è¡¨ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç åˆ›å»º<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SoftReference soft = new SoftReference(counter);</span><br></pre></td></tr></table></figure></p>
<p>é‰´äºè½¯å¼•ç”¨å’Œå¼±å¼•ç”¨è¿™ä¸€åŒºåˆ«ï¼Œè½¯å¼•ç”¨æ›´é€‚ç”¨äºç¼“å­˜æœºåˆ¶ï¼Œå¼±å¼•ç”¨æ›´é€‚ç”¨äºå­˜å‚¨å…ƒæ•°æ®ã€‚å¦ä¸€ä¸ªä½¿ç”¨è½¯å¼•ç”¨çš„ä¾‹å­æ˜¯ï¼ŒWeakHashMapï¼Œå®ƒæœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œmapé‡Œè¾¹çš„keyéƒ½è¢«å°è£…æˆå¼±å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦å¼ºå¼•ç”¨è¢«åˆ é™¤ï¼ŒWeakHashMapå†…éƒ¨çš„å¼±å¼•ç”¨å°±æ— æ³•ç»„ç»‡GCå¯¹è¯¥å¯¹è±¡çš„å›æ”¶ã€‚<br>è™šå¼•ç”¨æ˜¯java.lang.refåŒ…ä¸­çš„ç¬¬ä¸‰ç§å¼•ç”¨ï¼Œä½¿ç”¨java.lang.ref.PhantomReferenceç±»æ¥è¡¨ç¤ºã€‚æ‹¥æœ‰è™šå¼•ç”¨çš„å¯¹è±¡å¯ä»¥åœ¨ä»»ä½•æ—¶å€™è¢«GCå›æ”¶ï¼Œå’Œå…¶ä»–å½¢å¼ç±»ä¼¼ï¼Œåˆ›å»ºè™šå¼•ç”¨çš„å½¢å¼å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PhantomReference pr = new PhantomReference(counter);</span><br></pre></td></tr></table></figure></p>
<p>ä¸€ä¸ªå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/2018/05/31/java-reference/afd3fcba0d61a802c4a8ae970059ee77.gif" title="å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ"></p>
<p>åŸæ–‡å‡ºå¤„ï¼š<a href="http://www.importnew.com/10866.html" target="_blank" rel="noopener">http://www.importnew.com/10866.html</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.choleece.cn/2018/03/22/java-design-pattern/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="choleece">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="choleece">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/22/java-design-pattern/" itemprop="url">è®¾è®¡æ¨¡å¼ Javaç¯‡</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-03-22T22:51:49+08:00">
                2018-03-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="è®¾è®¡æ¨¡å¼-Javaç¯‡"><a href="#è®¾è®¡æ¨¡å¼-Javaç¯‡" class="headerlink" title="è®¾è®¡æ¨¡å¼  Javaç¯‡"></a>è®¾è®¡æ¨¡å¼  Javaç¯‡</h3><p>  GoFè®¾è®¡æ¨¡å¼æœ‰23ä¸ªï¼Œå®ƒä»¬å„å…·ç‰¹è‰²ï¼Œæ¯ä¸€ä¸ªè®¾è®¡æ¨¡å¼éƒ½ä¸ºæŸä¸€ä¸ªå¯é‡å¤çš„è®¾è®¡é—®é¢˜æä¾›äº†ä¸€å¥—è§£å†³æ–¹æ¡ˆã€‚æ ¹æ®å®ƒä»¬çš„ç”¨é€”ï¼Œè®¾è®¡æ¨¡å¼å¯åˆ†ä¸ºåˆ›å»ºå‹ï¼ˆCreationalï¼‰ï¼Œç»“æ„å‹ï¼ˆStructuralï¼‰å’Œè¡Œä¸ºå‹ï¼ˆBehavioralï¼‰ä¸‰ç§ï¼Œå…¶ä¸­åˆ›å»ºå‹æ¨¡å¼ä¸»è¦ç”¨äºæè¿°å¦‚ä½•åˆ›å»ºå¯¹è±¡ï¼Œç»“æ„å‹æ¨¡å¼ä¸»è¦ç”¨äºæè¿°å¦‚ä½•å®ç°ç±»æˆ–å¯¹è±¡çš„ç»„åˆï¼Œè¡Œä¸ºå‹æ¨¡å¼ä¸»è¦ç”¨äºæè¿°ç±»æˆ–å¯¹è±¡æ€æ ·äº¤äº’ä»¥åŠæ€æ ·åˆ†é…æŒ‡è´£ï¼Œåœ¨GoFè®¾è®¡æ¨¡å¼ä¸­åŒ…å«5ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œ7ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼å’Œ11ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ã€‚</p>
<h3 id="é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™"><a href="#é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™" class="headerlink" title="é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™"></a>é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™</h3><p>  å¯¹äºé¢å‘å¯¹è±¡è½¯ä»¶ç³»ç»Ÿçš„è®¾è®¡ï¼Œåœ¨æ”¯æŒå¯ç»´æŠ¤æ€§çš„åŒæ—¶ï¼Œæé«˜ç³»ç»Ÿçš„å¯å¤ç”¨æ€§æ˜¯ä¸€ä¸ªè‡³å…³é‡è¦çš„é—®é¢˜ã€‚å¦‚ä½•åŒæ—¶æé«˜ä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯å¤ç”¨æ€§æ˜¯é¢å‘å¯¹è±¡è®¾è®¡éœ€è¦è§£å†³çš„æ ¸å¿ƒé—®é¢˜ä¹‹ä¸€ã€‚åœ¨é¢å‘å¯¹è±¡è®¾è®¡ä¸­ï¼Œå¯ç»´æŠ¤æ€§çš„å¤ç”¨æ˜¯ä»¥è®¾è®¡åŸåˆ™ä¸ºåŸºç¡€çš„ã€‚æ¯ä¸€ä¸ªåŸåˆ™éƒ½è•´å«ä¸€äº›é¢å‘å¯¹è±¡è®¾è®¡çš„æ€æƒ³ï¼Œå¯ä»¥ä»ä¸åŒçš„è§’åº¦æå‡ä¸€ä¸ªè½¯ä»¶ç»“æ„çš„è®¾è®¡æ°´å¹³ã€‚é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™ä¸ºæ”¯æŒå¯ç»´æŠ¤æ€§å¤ç”¨è€Œè¯ç”Ÿã€‚</p>
<p>  æœ€å¸¸è§çš„7ä¸­é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
  <img src="/2018/03/22/java-design-pattern/design_principle.jpg" title="å¸¸è§è®¾è®¡åŸåˆ™">

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.choleece.cn/2018/03/19/certbot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="choleece">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="choleece">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/19/certbot/" itemprop="url">https å®‰å…¨è¯ä¹¦éƒ¨ç½² certbot let's encrypt</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-03-19T07:24:40+08:00">
                2018-03-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Letâ€™s-Encrypt-Https-å®‰å…¨è¯ä¹¦-certbot"><a href="#Letâ€™s-Encrypt-Https-å®‰å…¨è¯ä¹¦-certbot" class="headerlink" title="Letâ€™s Encrypt Https å®‰å…¨è¯ä¹¦ certbot"></a>Letâ€™s Encrypt Https å®‰å…¨è¯ä¹¦ certbot</h3><p>ä¸ºäº†ä½¿ä½ çš„ç½‘ç«™æ”¯æŒhttpsï¼Œä½ å¿…é¡»ä»Certificate Authorityï¼ˆCAï¼‰è·å¾—ä¸€ä¸ªè¯ä¹¦ï¼Œ Letâ€™s Encrypt å°±æ˜¯ä¸€ä¸ªCAã€‚Letâ€™s Encryptéƒ¨ç½²èµ·æ¥å¾ˆç®€å•ï¼Œä½¿ç”¨ç”µå­å­å‰å“¨åŸºé‡‘ä¼šçš„Certbotå°±å¯ä»¥å®Œæˆï¼Œä¸‹é¢å°±ä»‹ç»åˆ©ç”¨Certbotå®Œæˆhttpsçš„éƒ¨ç½²ã€‚</p>
<h3 id="æ“ä½œæ­¥éª¤"><a href="#æ“ä½œæ­¥éª¤" class="headerlink" title="æ“ä½œæ­¥éª¤"></a>æ“ä½œæ­¥éª¤</h3><p>1.æ‰“å¼€Letâ€™s Encrypt å®˜ç½‘</p>
<p>  <a href="https://letsencrypt.org/getting-started/" target="_blank" rel="noopener">https://letsencrypt.org/getting-started/</a></p>
<p>2.é€‰æ‹©å…¶ä¸­çš„With Shell Accessï¼Œç‚¹å‡»Certbotæ¥åˆ°Certbotå®˜ç½‘ï¼Œå‰ä¸¤æ­¥ä¹Ÿå¯ç›´æ¥ç‚¹å‡»Certbotå®˜ç½‘</p>
<p>  <a href="https://certbot.eff.org/lets-encrypt/" target="_blank" rel="noopener">https://certbot.eff.org/lets-encrypt/</a></p>
<p>3.æ ¹æ®è‡ªå·±çš„çš„æœåŠ¡å™¨éœ€æ±‚å®‰è£…ï¼Œæˆ‘é€‰çš„æ˜¯Nginx + Centos7</p>
<img src="/2018/03/19/certbot/certbot.jpg" title="é€‰æ‹©æœåŠ¡å™¨ç¯å¢ƒ">
<p>4.ä¸ºäº†ç«‹é©¬å°±èƒ½çœ‹è§æ•ˆæœï¼Œå…ˆä¿è¯nginx 80ç«¯å£å·²ç»å¼€å¯ã€‚æ¥ä¸‹æ¥æŒ‰ç…§å®˜ç½‘çš„æ­¥éª¤èµ°</p>
<p>é¦–å…ˆå…è®¸EPELä»“åº“</p>
<pre><code>yum -y install yum-utils
yum-config-manager --enable rhui-REGION-rhel-server-extras rhui-REGION-rhel-server-optional
</code></pre><p>å®‰è£…certbot-nginx</p>
<pre><code>yum install certbot-nginx
</code></pre><p>å¼€å§‹è¿è¡Œ</p>
<pre><code>certbot --nginx
</code></pre><p>ä»¥ä¸Šæ­¥éª¤æ˜¯certbotå®˜æ–¹ç½‘ç«™ä¸Šçš„æ“ä½œæ­¥éª¤ï¼Œè¿›è¡Œè¿™ä¸€æ­¥æ—¶ï¼Œå›å‡ºç°é”™è¯¯ï¼Œé”™è¯¯å¦‚ä¸‹ï¼š</p>
<img src="/2018/03/19/certbot/certbot_error.jpg" title="è¿è¡ŒæŠ¥é”™">
<p>è§£å†³æ–¹æ¡ˆ<br>  ä»¥ä¸ŠæŠ¥é”™æ˜¯pythonåŒ…æ²¡æ‰¾åˆ°ï¼Œä¸‹è¾¹ä»‹ç»å¦å¤–ä¸€ç§æ–¹æ³•ï¼Œåˆ©ç”¨pipè¿›è¡Œå®‰è£…</p>
<p>  é¦–å…ˆå‡çº§pip</p>
<pre><code>pip install --upgrade pip
</code></pre><p>  å¸è½½yumå®‰è£…çš„certbotå’ŒpyOpenSSL</p>
<pre><code>yum remove certbot-nginx pyOpenSSL
</code></pre><p>  pipå®‰è£…certbot</p>
<pre><code>pip install certbot-nginx
</code></pre><p>  å¦‚æœç¢°åˆ°äº†Python.hæˆ–è€…pyconfig.hæ‰¾ä¸åˆ°çš„é”™è¯¯ï¼Œäºæ˜¯å®‰è£…Pythonçš„develåŒ…ï¼ˆä¸ä¸€å®šä¼šå‡ºç°ï¼‰ï¼š</p>
<pre><code>yum install -y python-devel
</code></pre><p>  å†æ¬¡è¿è¡Œpip install certbot-nginx,å¦‚æœæç¤ºæ‰¾ä¸åˆ°opensslv.hå¤´æ–‡ä»¶ï¼Œäºæ˜¯å®‰è£…OpenSSLçš„develåŒ…ï¼ˆä¸ä¸€å®šå‡ºç°ï¼‰ï¼š</p>
<pre><code>yum install -y openssl-devel
</code></pre><p>  å¦‚æœpip install certbot-nginx ä¸€æ¬¡æˆåŠŸï¼Œåˆ™ä¸éœ€è¦è¿è¡Œä¸Šè¾¹ä¸¤å¥å‘½ä»¤ã€‚</p>
<p>  æœ‰æ—¶å€™æ ¹æ®ç³»ç»Ÿçš„ä¸åŒä¼šå‡ºç°ä¸åŒçš„æƒ…å†µï¼Œè¿‘æœŸåœ¨é…ç½®ç³»ç»Ÿçš„ä¸Šè¿°æ–¹æ³•ä¸å¤ªå¥½ç”¨ï¼Œå…·ä½“åŸå› æ˜¯pyOpenSSLç‰ˆæœ¬å¤ªé«˜ï¼Œå½“æ—¶æ“ä½œçš„æ—¶å€™æ˜¯18,ç”¨yumé»˜è®¤å®‰è£…çš„æ˜¯0.13ï¼Œä½†æ˜¯certbotè¿è¡Œçš„ç‰ˆæœ¬è¦æ±‚&gt;=0.14ï¼Œç„¶åæˆ‘è¯•ç€é‡æ–°å»ä¸‹è½½äº†0.15,å‘ç°æœ‰å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œç„¶åé‡æ–°ä¸‹äº†ä¸€é0.17ï¼Œå¥‡è¿¹èˆ¬çš„å¥½ç”¨äº†ï¼Œä¸‹é¢è´´å‡ºä¸‹è½½é“¾æ¥ï¼š<br>  <a href="http://rpm.pbone.net/index.php3/stat/4/idpl/44092374/dir/centos_7/com/python2-pyOpenSSL-17.3.0-3.el7.noarch.rpm.html" target="_blank" rel="noopener">http://rpm.pbone.net/index.php3/stat/4/idpl/44092374/dir/centos_7/com/python2-pyOpenSSL-17.3.0-3.el7.noarch.rpm.html</a><br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å…ˆè¿›è¡Œä¸‹è½½ï¼š</span><br><span class="line">    wget ftp://ftp.ntua.gr/pub/linux/centos/7.5.1804/cloud/x86_64/openstack-queens/python2-pyOpenSSL-17.3.0-3.el7.noarch.rpm;</span><br><span class="line">ç„¶åå®‰è£…:</span><br><span class="line">    rpm -Uvh pyOpenSSL.**.rpm</span><br></pre></td></tr></table></figure></p>
<p>è‡ªåŠ¨ç»­æœŸ</p>
<p>  letâ€™s encrypt è¯ä¹¦é»˜è®¤çš„æœ‰æ•ˆæœŸæ˜¯90å¤©çš„æ—¶é—´ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªåŠ¨ç»­æœŸ</p>
<p>  å…ˆæ¥æ·»åŠ ä¸€ä¸ªservice</p>
<pre><code>$ sudo vim /etc/systemd/system/letsencrypt.service

[Unit]
Description=Let&apos;s Encrypt renewal

[Service]
Type=oneshot
ExecStart=/usr/bin/certbot renew --quiet --agree-tos
ExecStartPost=/bin/systemctl reload nginx.service
</code></pre><p>  ç„¶åæ·»åŠ ä¸€ä¸ªsystemd timeræ¥å®šæ—¶è§¦å‘è¿™ä¸ªä»»åŠ¡</p>
<pre><code>$ sudo vim /etc/systemd/system/letsencrypt.timer
[Unit]
Description=Daily renewal of Let&apos;s Encrypt&apos;s certificates

[Timer]
OnCalendar=daily
Persistent=true

[Install]
WantedBy=timers.target
</code></pre><p>  å¯åŠ¨æœåŠ¡ï¼Œå¼€å¯timer</p>
<pre><code>$ sudo systemctl enable letsencrypt.timer
$ sudo systemctl start letsencrypt.timer
</code></pre><p>  ä»¥ä¸Šæ€»ä½“æŒ‰ç…§å®˜ç½‘æ¯æ¬¡æ“ä½œéƒ½æœ‰ä¸åŒçš„é—®é¢˜ï¼Œå¸Œæœ›èƒ½å‡ºä¸ªç¨³å®šçš„ç‰ˆæœ¬ï¼Œåæ­£æŒ‰ç…§å®˜ç½‘çš„æ­¥éª¤ï¼Œä¸€å®šæ˜¯ä¼šå‡ºé”™ï¼ˆè‡³å°‘æˆ‘å®è·µè¿™ä¹ˆå¤šæ¬¡æ˜¯è¿™æ ·ï¼‰</p>
<p>å‚è€ƒé“¾æ¥ï¼š</p>
<p>  <a href="https://letsencrypt.org/getting-started/" target="_blank" rel="noopener">https://letsencrypt.org/getting-started/</a></p>
<p>  <a href="https://certbot.eff.org/lets-encrypt/centosrhel7-nginx" target="_blank" rel="noopener">https://certbot.eff.org/lets-encrypt/centosrhel7-nginx</a></p>
<p>  <a href="https://tlanyan.me/certbot-importerror-pyopenssl-module-missing-required-functionality/" target="_blank" rel="noopener">https://tlanyan.me/certbot-importerror-pyopenssl-module-missing-required-functionality/</a></p>
<p>  <a href="https://blog.nswebfrog.com/2017/12/14/letsencrypt-renew/" target="_blank" rel="noopener">https://blog.nswebfrog.com/2017/12/14/letsencrypt-renew/</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.choleece.cn/2018/01/16/tab-view-md/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="choleece">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="choleece">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/16/tab-view-md/" itemprop="url">å°ç¨‹åºé¡¶éƒ¨TabView</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-01-16T23:03:11+08:00">
                2018-01-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä¸‹é¢æˆ‘ä»¬å°†åˆ©ç”¨å°ç¨‹åºçš„scroll-view &amp; swipperåˆ¶ä½œtab-view</p>
<h3 id="å»ºç«‹wxml"><a href="#å»ºç«‹wxml" class="headerlink" title="å»ºç«‹wxml"></a>å»ºç«‹wxml</h3><p>æ•´ä¸ªé¡µé¢ç”±é¡¶éƒ¨çš„æ ‡é¢˜æ +å¯æ»‘åŠ¨çš„bodyç»„æˆ</p>
<pre><code>&lt;view class=&quot;stv-container&quot;&gt;
  &lt;view class=&quot;tab-bar&quot;&gt;
    &lt;view wx:for=&quot;{{titles}}&quot; wx:key=&quot;unique&quot; data-index=&quot;{{index}}&quot; bindtap=&quot;handlerTabTap&quot; class=&quot;tab {{activeIndex==index?'tab-active':''}}&quot; style=&quot;width: {{stv.windowWidth/titles.length}}px&quot;&gt;
        &lt;text&gt;{{item}}&lt;/text&gt;
    &lt;/view&gt;
    &lt;view style=&quot;width: {{stv.lineWidth}}px; left: {{stv.offset/titles.length}}px&quot; class=&quot;under-line {{!stv.tStart? 'withAnimate': ''}}&quot;&gt;&lt;/view&gt;
  &lt;/view&gt;
  &lt;view style=&quot;padding: 15px; height: 100%; margin-top: 30px; background-color: #fafafa&quot;&gt;
    &lt;swiper duration=&quot;500&quot; bindchange=&quot;swiper&quot; current=&quot;{{activeIndex}}&quot; style=&quot;height: 100%&quot;&gt;
        &lt;block wx:for=&quot;{{contents}}&quot; wx:key=&quot;*this&quot;&gt;
            &lt;swiper-item&gt;
                &lt;view style=&quot;height: 100%&quot;&gt;
                    &lt;text&gt;{{contents[index]}}&lt;/text&gt;
                &lt;/view&gt;
            &lt;/swiper-item&gt;
        &lt;/block&gt;
    &lt;/swiper&gt;
  &lt;/view&gt;
&lt;/view&gt;
</code></pre><h3 id="å»ºç«‹wxjs"><a href="#å»ºç«‹wxjs" class="headerlink" title="å»ºç«‹wxjs"></a>å»ºç«‹wxjs</h3><p>  ä»¥ä¸Šä»£ç æ˜¯æ•´ä¸ªé¡µé¢çš„å¸ƒå±€ï¼Œ å¯æ»‘åŠ¨çš„bodyæˆ‘ä»¬ç”¨swiperç»„æˆï¼Œæ¥ä¸‹æ¥æ˜¯ç»„æˆé¡µé¢çš„æ•°æ®æ»‘åŠ¨æˆ–è€…ç‚¹å‡»çš„æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>// pages/newMusic/index.js
Page({
  /**
  * é¡µé¢çš„åˆå§‹æ•°æ®
  */
  data: {
    activeIndex: 0,
    stv: {
      windowWidth: 0,
      lineWidth: 0,
      offset: 0,
      tStart: false
    },
    titles: [&apos;æ–‡å­—ä¸€&apos;, &apos;æ–‡å­—äºŒ&apos;, &apos;æ–‡å­—ä¸‰&apos;, &apos;æ–‡å­—å››&apos;],
    contents: [
      &quot;å°æ—¶å€™ï¼Œæˆ‘ç©¿ç€è€çˆ¸çš„ç›´ç­’è¢œï¼Œæƒ³è±¡ç€æˆ‘åœ¨å¤§è¥¿éƒ¨è®ºå›çƒé¦†ï¼ŒæŠ•ä¸­åˆ¶èƒœçƒçš„æ ·å­ï¼Œæˆ‘å°±æ·±æ·±æ˜ç™½ä¸€ä»¶äº‹ï¼Œæˆ‘çˆ±ä¸Šäº†ç¯®çƒï¼Œæˆ‘çˆ±ä½ å¦‚æ­¤æ·±ä»¥è‡´è´¡çŒ®æ‰€æœ‰ï¼Œ æˆ‘çš„æ€æƒ³å’Œèº«ä½“ï¼Œ æˆ‘çš„ç²¾ç¥å’Œçµé­‚ï¼Œ å…­å²å¼€å§‹ï¼Œ æˆ‘å°±æ·±çˆ±ç€ä½ &quot;,
      &quot;ä»æœªæƒ³åˆ°è¿‡ç»“æŸï¼Œæˆ‘åªçœ‹åˆ°è‡ªå·±ï¼Œåœ¨è¿™æ¡è·¯ä¸Šå¥”è·‘åˆ°å°½å¤´ï¼Œæ‰€ä»¥æˆ‘ä¸åœåœ°è·‘ï¼Œåœ¨ æ¯ä¸ªçƒé¦†æˆ‘å…¨åŠ›å¥”è·‘ï¼Œä¸ºä½ äº‰å–æ¯æ¬¡æœºä¼šï¼Œä½ è¦æ±‚æˆ‘æ‹¼å°½æ‰€æœ‰ï¼Œæ‰€ä»¥æˆ‘å¥‰ä¸ŠçœŸå¿ƒï¼Œå› ä¸ºè¿™é‡ŒåŒ…å«å¤ªå¤šï¼Œæˆ‘å¸¦ç€æ±—æ°´å’Œä¼¤ç—›ï¼Œä¸ä»…å› ä¸ºæŒ‘æˆ˜&quot;,
      &quot;è€Œæ˜¯ä½ åœ¨å¬å”¤æˆ‘ï¼Œæˆ‘ä¸ºä½ å¥‰çŒ®æ‰€æœ‰ï¼Œå› ä¸ºä½ ä¹Ÿèµ äºˆæˆ‘å…¨éƒ¨ï¼Œå› ä¸ºç¯®çƒï¼Œæˆ‘æ„Ÿåˆ°æ˜¯ä¸€ä¸ªé²œæ´»çš„äººï¼Œä½ è®©6å²å­©å­å®ç°æ¹–äººæ¢¦ï¼Œä¸ºæ­¤æˆ‘å°†æ°¸è¿œçˆ±ä½ ï¼Œä½†æˆ‘ä¸èƒ½å†è¿·æ‹ä½ ï¼Œè¿™ä¸ªèµ›å­£æ˜¯æˆ‘ä»…èƒ½ç»™ï¼Œå¿ƒè¿˜èƒ½ç»§ç»­æ‰¿å—æ‰“å‡»ï¼Œæ„å¿—ä¹Ÿè¿˜èƒ½è¢«ç¢¾ç£¨&quot;,
      &quot;ä½†èº«ä½“çŸ¥é“æ˜¯æ—¶å€™è¯´å†è§ï¼Œæˆ‘å·²ç»å‡†å¤‡è®©ä½ ç¦»å¼€ï¼Œç°åœ¨åªæ˜¯æƒ³è®©ä½ çŸ¥é“ï¼Œæˆ‘ä»¬èƒ½æ°¸è¿œçè—ç€æ¯æ®µæ—¶å…‰ï¼Œæ— è®ºæ˜¯å¥½çš„ï¼Œè¿˜æ˜¯åçš„ï¼Œæˆ‘ä»¬å·²è´¡çŒ®ç»™å½¼æ­¤ï¼Œæ‰€æœ‰çš„å…¨éƒ¨ï¼Œæ— è®ºæ¥ä¸‹æ¥æˆ‘ä¼šåšä»€ä¹ˆï¼Œæˆ‘éƒ½ä¼šæ˜¯é‚£ä¸ªå­©å­ï¼Œç©¿ç€è€çˆ¸ç›´ç­’è¢œï¼Œç„å‡†è§’è½é‡Œçš„åƒåœ¾æ¡¶&quot;
      ]
    },

  /**
  * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢åŠ è½½
  */
  onLoad: function (options) {},

  bodyChange: function(e) {
    console.log(e.target.dataset.value);
    this.setData({
      activeIndex: e.target.dataset.value
    });
  },
  swiper: function(e){
    this._updateSelectedPage(e.detail.current);
  },
  bodyscroll:function(e){
    console.log(e);
  },
  _updateSelectedPage(page) {
    let {titles, stv, activeIndex} = this.data;
    activeIndex = page;
    this.setData({activeIndex: activeIndex})
    stv.offset = stv.windowWidth*activeIndex;
    this.setData({stv: this.data.stv})
  },
  handlerTabTap(e) {
    this._updateSelectedPage(e.currentTarget.dataset.index);
  }
});
</code></pre><h3 id="å»ºç«‹WXSS"><a href="#å»ºç«‹WXSS" class="headerlink" title="å»ºç«‹WXSS"></a>å»ºç«‹WXSS</h3><p>  ä»¥ä¸‹å†…å®¹ä¸ºé¡µé¢æ ·å¼ï¼š</p>
<pre><code>.stv-container {
  height: 100%
}
.withAnimate {
  transition: all 100ms ease;
  -webkit-transform: translate3d(0, 0, 0);
  -moz-transform: translate3d(0, 0, 0);
  -ms-transform: translate3d(0, 0, 0);
  transform: translate3d(0, 0, 0);
  -webkit-backface-visibility: hidden;
  -moz-backface-visibility: hidden;
  -ms-backface-visibility: hidden;
  backface-visibility: hidden;
  -webkit-perspective: 1000;
  -moz-perspective: 1000;
  -ms-perspective: 1000;
  perspective: 1000;
}
.stv-container .tab-bar {
  position: fixed;
  display: flex;
  font-size: 30rpx;
  color: #666666;
  background-color: #fff;
  z-index: 999;
  top: 0;
}
.stv-container .tab-bar .tab-active {
  color: #2d80ff;
}
.stv-container .tab-bar .tab {
  display: flex;
  align-items: center;
  justify-content: center;
  padding-top: 16rpx;
  padding-bottom: 20rpx;
}
.stv-container .tab-bar .under-line {
  position: absolute;
  bottom: 0;
  height: 6rpx;
  background-color: #2d80ff;
}
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.choleece.cn/2018/01/13/redux-hello-world-md/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="choleece">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="choleece">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/13/redux-hello-world-md/" itemprop="url">åˆè¯†redux</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-01-13T19:58:33+08:00">
                2018-01-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ä»€ä¹ˆæ˜¯Reduxï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯Reduxï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯Reduxï¼Ÿ"></a>ä»€ä¹ˆæ˜¯Reduxï¼Ÿ</h2><p>&nbsp;&nbsp; Redux æ˜¯ä¸€ä¸ªJavaScript Appçš„å¯é¢„æµ‹çš„çŠ¶æ€ç®¡ç†å™¨ã€‚</p>
<h2 id="ä½•æ—¶ç”¨Reduxï¼Ÿ"><a href="#ä½•æ—¶ç”¨Reduxï¼Ÿ" class="headerlink" title="ä½•æ—¶ç”¨Reduxï¼Ÿ"></a>ä½•æ—¶ç”¨Reduxï¼Ÿ</h2><p>&nbsp;&nbsp; æ›¾ç»æœ‰äººè¯´è¿‡ï¼Œå¦‚æœä½ ä¸çŸ¥é“æ˜¯å¦éœ€è¦Redux, é‚£ä¹ˆä½ å°±æ˜¯ä¸éœ€è¦Redux.åæ¥Reduxçš„ä½œè€…Dan Abramovåˆè¡¥å……äº†ä¸€å¥<em>åªæœ‰é‡åˆ°Reactå®åœ¨è§£å†³ä¸äº†çš„é—®é¢˜æ—¶å€™åˆ°ä½ æ‰éœ€è¦ä½¿ç”¨Redux</em>ã€‚ç®€å•è®²ï¼Œå¦‚æœä½ çš„åº”ç”¨ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œè§†å›¾å±‚åªä»å•ä¸€çš„æ•°æ®æºè·å–æ•°æ®ï¼Œæ“ä½œç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œä½ å°±ä¸éœ€è¦ä½¿ç”¨Reduxã€‚æ‹¿Reactæ¥ä½œæ¯”ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒReactçš„è§†å›¾å±‚çš„æ¸²æŸ“ä¾èµ–ç€æ¯ä¸ªç»„ä»¶çš„å†…éƒ¨çŠ¶æ€ï¼Œå½“åº”ç”¨è¶³å¤Ÿå¤§äº†ä¹‹åï¼Œå°±å¾ˆéš¾ç®¡ç†æ¯ä¸ªç»„ä»¶çš„çŠ¶æ€ï¼Œè¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦æœ‰ä¸€ä¸ªåœ°æ–¹æ¥å­˜å‚¨æ•´ä¸ªåº”ç”¨çš„çŠ¶æ€ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬çš„reduxå°±å‡ºåœºäº†.</p>
<h2 id="è®¾è®¡æ€æƒ³"><a href="#è®¾è®¡æ€æƒ³" class="headerlink" title="è®¾è®¡æ€æƒ³"></a>è®¾è®¡æ€æƒ³</h2><p>  æ€»ç»“èµ·æ¥ï¼Œä¸¤å¥è¯ï¼š</p>
<ul>
<li>webåº”ç”¨æ˜¯ä¸€ä¸ªçŠ¶æ€æœºå™¨ï¼Œè§†å›¾ä¸çŠ¶æ€æ˜¯ä¸€ä¸€å¯¹åº”çš„</li>
<li>åº”ç”¨æ‰€æœ‰çš„çŠ¶æ€ï¼Œéƒ½ä¿å­˜åœ¨ä¸€ä¸ªå¯¹è±¡æ ‘é‡Œï¼Œéšå¤„å¯å–</li>
</ul>
<h2 id="Redux-çš„å®‰è£…"><a href="#Redux-çš„å®‰è£…" class="headerlink" title="Redux çš„å®‰è£…"></a>Redux çš„å®‰è£…</h2><pre><code>npm install redux --save
</code></pre><h2 id="Reduxçš„åŸºæœ¬æ¦‚å¿µ"><a href="#Reduxçš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="Reduxçš„åŸºæœ¬æ¦‚å¿µ"></a>Reduxçš„åŸºæœ¬æ¦‚å¿µ</h2><h3 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h3><p>  Storeå°±æ˜¯Reduxç®¡ç†æ•´ä¸ªwebåº”ç”¨çŠ¶æ€çš„åœ°æ–¹ï¼Œåº”ç”¨åœ¨ä»»ä½•åœ°æ–¹å¯ä»¥ä»è¿™æ£µçŠ¶æ€æ ‘ä¸Šå–å¾—æ•°æ®ï¼Œç”¨äºç»„ä»¶çš„æ¸²æŸ“å’Œè®¡ç®—<br>  Reduxæä¾›createStoreè¿™ä¸ªå‡½æ•°åˆ›å»ºStoreï¼Œæ•´ä¸ªåº”ç”¨åªå…è®¸æœ‰ä¸€ä¸ªStoreã€‚</p>
<pre><code>import { createStore } from &apos;redux&apos;;
const store = createStore(fn);
</code></pre><h3 id="State"><a href="#State" class="headerlink" title="State"></a>State</h3><p>  å‰é¢æˆ‘ä»¬ä»‹ç»åˆ°ï¼ŒStoreåŒ…å«äº†æ•´ä¸ªwebï¼ˆå½“ç„¶æ­¤æ—¶æ¯ä¸ªç»„ä»¶å†…éƒ¨ä¹Ÿå¯åŒæ—¶ç»´æŠ¤è‡ªå·±çš„stateï¼‰åº”ç”¨çš„çŠ¶æ€æ•°æ®ï¼Œå¦‚æœæƒ³å¾—åˆ°æŸä¸ªæ—¶åˆ»çš„çŠ¶æ€ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä»è¿™æ£µçŠ¶æ€æ ‘ä¸Šè·å–è‡ªå·±çš„æ•°æ®ã€‚è¿™ä¸ªæ—¶åˆ»çš„æ•°æ®ï¼Œå°±å«åšState,å½“å‰æ—¶åˆ»çš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡store.getState()å‡½æ•°è·å–ã€‚</p>
<pre><code>import { createStore } from &apos;redux&apos;;
const store = createStore(fn);
const state = store.getState();
</code></pre><p>  åœ¨å¼€å‘Reactçš„æ—¶å€™ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œstateå¯¹åº”viewï¼Œè·Ÿè§†å›¾å±‚ç›¸å…³çš„stateï¼Œå¦‚æœstateå€¼ç›¸åŒï¼Œåˆ™æ¸²æŸ“å‡ºæ¥çš„UIç›¸åŒã€‚</p>
<h3 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h3><p>  å‰é¢æœ‰æåˆ°è¿‡ï¼ŒStateçš„å˜åŒ–ï¼Œå¯èƒ½ä¼šå¯¼è‡´Viewçš„å˜åŒ–ã€‚ç”¨æˆ·èƒ½æ¥è§¦åˆ°çš„æ˜¯è§†å›¾å±‚ï¼Œåªèƒ½é€šè¿‡æŸç§äº‹ä»¶æ¥è§¦å‘Stateçš„æ”¹å˜ï¼ŒActionå°±æ˜¯å……å½“ä¸­é—´çš„ä¿¡ä½¿ï¼Œè¡¨ç¤ºStateè¦æ›´æ–°äº†<br>  Actionæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­typeå±æ€§æ˜¯å¿…é¡»çš„,è¡¨è¿°Actionè¦åšä»€ä¹ˆæ“ä½œã€‚</p>
<pre><code>const action = {
  type: ADD_LIST,
  payload: &apos;Redux&apos;
}
</code></pre><p>  åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œè¦åšçš„æ“ä½œæ˜¯ADD_LISTï¼Œæ‰€æºå¸¦çš„ä¿¡æ¯payloadçš„å†…å®¹ä¸ºReduxã€‚ä»ä¸Šè¿°ä¾‹å­å¯ä»¥çœ‹å‡ºï¼ŒActionæè¿°çš„æ˜¯å°†è¦å‘ç”Ÿçš„äº‹ï¼Œæ”¹å˜Stateå”¯ä¸€çš„é€”å¾„å°±æ˜¯é€šè¿‡è§¦å‘Actionã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">choleece</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">choleece</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
